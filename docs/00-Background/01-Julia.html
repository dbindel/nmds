<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Julia programming – Numerical Methods for Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../00-Background/02-Performance.html" rel="next">
<link href="../00-Background/00-Intro.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../00-Background/00-Intro.html">Background Plus a Bit</a></li><li class="breadcrumb-item"><a href="../00-Background/01-Julia.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Julia programming</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Numerical Methods for Data Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../00-Background/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Background Plus a Bit</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-Background/01-Julia.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Julia programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-Background/02-Performance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Performance Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-Background/03-LA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Linear Algebra</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-Background/04-Calculus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Calculus and analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-Background/05-Optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Optimization theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00-Background/06-Probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../01-Fund1d/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fundamentals in 1D</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-Fund1d/01-Error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Notions of Error</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-Fund1d/02-Arithmetic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Floating Point</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-Fund1d/03-Approximation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Approximation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-Fund1d/04-AutoDiff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Automatic Differentiation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-Fund1d/05-NumDiff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Numerical Differentiation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-Fund1d/06-Quadrature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Quadrature</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-Fund1d/07-Roots-Opt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Root Finding and Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-Fund1d/08-Random.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Computing with Randomness</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../02-NLA/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numerical Linear Algebra</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-NLA/01-Systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Linear Systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-NLA/02-Least-Squares.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Least Squares</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-NLA/03-Eigenvalues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Eigenvalue Problems and the SVD</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-NLA/04-Signals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Signals and Transforms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-NLA/05-Stationary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Stationary Iterations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-NLA/06-Krylov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Krylov Subspaces</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../03-Nonlinear/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonlinear Equations and Optimization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-Nonlinear/01-Calculus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Calculus Revisited</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-Nonlinear/02-Nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Nonlinear Equations and Unconstrained Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-Nonlinear/03-Continuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Continuation and Bifurcation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-Nonlinear/04-Constrained.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Constrained Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-Nonlinear/05-Least-Squares.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Nonlinear Least Squares</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../04-Random/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computing with Randomness</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-Random/01-Sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-Random/02-Monte-Carlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quadrature and Monte Carlo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-Random/03-Solvers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Solvers from Monte Carlo to Las Vegas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-Random/04-UQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Uncertainty Quantification</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../05-Reduction/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dimension Reduction and Latent Factor Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05-Reduction/01-Matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Latent Factors and Matrix Factorization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05-Reduction/02-Tensor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">From Matrices to Tensors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05-Reduction/03-Nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Nonlinear Dimensionality Reduction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../06-Approximation/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Function Approximation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06-Approximation/01-Concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Fundamental Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06-Approximation/02-Low-Dimension.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Low-Dimensional Structure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06-Approximation/03-Kernels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Kernels and RBFs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06-Approximation/04-NN.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Neural Networks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../07-Networks/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07-Networks/01-Matrices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Graphs and Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07-Networks/02-Functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Functions on Graphs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07-Networks/03-Cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Clustering and Partitioning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07-Networks/04-Centrality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Centrality Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../08-Dynamics/00-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learning Dynamics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08-Dynamics/01-Fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Fundamentals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08-Dynamics/02-Model-Reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Model Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08-Dynamics/03-Linear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Learning Linear Dynamics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08-Dynamics/04-Extrapolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Extrapolation and Acceleration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08-Dynamics/05-Koopman.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">From Markov to Koopman</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08-Dynamics/06-Nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Learning Nonlinear Dynamics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#interacting-with-julia" id="toc-interacting-with-julia" class="nav-link active" data-scroll-target="#interacting-with-julia"><span class="header-section-number">2.1</span> Interacting with Julia</a>
  <ul class="collapse">
  <li><a href="#the-julia-prompt" id="toc-the-julia-prompt" class="nav-link" data-scroll-target="#the-julia-prompt"><span class="header-section-number">2.1.1</span> The Julia prompt</a></li>
  <li><a href="#jupyter-notebooks" id="toc-jupyter-notebooks" class="nav-link" data-scroll-target="#jupyter-notebooks"><span class="header-section-number">2.1.2</span> Jupyter notebooks</a></li>
  <li><a href="#pluto-notebooks" id="toc-pluto-notebooks" class="nav-link" data-scroll-target="#pluto-notebooks"><span class="header-section-number">2.1.3</span> Pluto notebooks</a></li>
  </ul></li>
  <li><a href="#simple-expressions" id="toc-simple-expressions" class="nav-link" data-scroll-target="#simple-expressions"><span class="header-section-number">2.2</span> Simple expressions</a>
  <ul class="collapse">
  <li><a href="#assignment-scopes-and-variable-types" id="toc-assignment-scopes-and-variable-types" class="nav-link" data-scroll-target="#assignment-scopes-and-variable-types"><span class="header-section-number">2.2.1</span> Assignment, scopes, and variable types</a></li>
  <li><a href="#arithmetic-operations" id="toc-arithmetic-operations" class="nav-link" data-scroll-target="#arithmetic-operations"><span class="header-section-number">2.2.2</span> Arithmetic operations</a></li>
  <li><a href="#logical-operations" id="toc-logical-operations" class="nav-link" data-scroll-target="#logical-operations"><span class="header-section-number">2.2.3</span> Logical operations</a></li>
  <li><a href="#comparisons" id="toc-comparisons" class="nav-link" data-scroll-target="#comparisons"><span class="header-section-number">2.2.4</span> Comparisons</a></li>
  <li><a href="#simple-calls" id="toc-simple-calls" class="nav-link" data-scroll-target="#simple-calls"><span class="header-section-number">2.2.5</span> Simple calls</a></li>
  <li><a href="#broadcasting-operations" id="toc-broadcasting-operations" class="nav-link" data-scroll-target="#broadcasting-operations"><span class="header-section-number">2.2.6</span> Broadcasting operations</a></li>
  <li><a href="#indexing-and-slicing" id="toc-indexing-and-slicing" class="nav-link" data-scroll-target="#indexing-and-slicing"><span class="header-section-number">2.2.7</span> Indexing and slicing</a></li>
  <li><a href="#structure-access" id="toc-structure-access" class="nav-link" data-scroll-target="#structure-access"><span class="header-section-number">2.2.8</span> Structure access</a></li>
  <li><a href="#strings" id="toc-strings" class="nav-link" data-scroll-target="#strings"><span class="header-section-number">2.2.9</span> Strings</a></li>
  </ul></li>
  <li><a href="#control-flow" id="toc-control-flow" class="nav-link" data-scroll-target="#control-flow"><span class="header-section-number">2.3</span> Control flow</a>
  <ul class="collapse">
  <li><a href="#conditional-statements" id="toc-conditional-statements" class="nav-link" data-scroll-target="#conditional-statements"><span class="header-section-number">2.3.1</span> Conditional statements</a></li>
  <li><a href="#sec-julia-loops" id="toc-sec-julia-loops" class="nav-link" data-scroll-target="#sec-julia-loops"><span class="header-section-number">2.3.2</span> Loops</a></li>
  </ul></li>
  <li><a href="#functions-and-methods" id="toc-functions-and-methods" class="nav-link" data-scroll-target="#functions-and-methods"><span class="header-section-number">2.4</span> Functions and methods</a>
  <ul class="collapse">
  <li><a href="#defining-functions" id="toc-defining-functions" class="nav-link" data-scroll-target="#defining-functions"><span class="header-section-number">2.4.1</span> Defining functions</a></li>
  <li><a href="#defaults-and-keywords" id="toc-defaults-and-keywords" class="nav-link" data-scroll-target="#defaults-and-keywords"><span class="header-section-number">2.4.2</span> Defaults and keywords</a></li>
  <li><a href="#sec-julia-closures" id="toc-sec-julia-closures" class="nav-link" data-scroll-target="#sec-julia-closures"><span class="header-section-number">2.4.3</span> Closures</a></li>
  <li><a href="#sec-julia-methods" id="toc-sec-julia-methods" class="nav-link" data-scroll-target="#sec-julia-methods"><span class="header-section-number">2.4.4</span> Methods</a></li>
  <li><a href="#sec-julia-op-overloading" id="toc-sec-julia-op-overloading" class="nav-link" data-scroll-target="#sec-julia-op-overloading"><span class="header-section-number">2.4.5</span> Operator overloading</a></li>
  <li><a href="#sec-julia-higher-order" id="toc-sec-julia-higher-order" class="nav-link" data-scroll-target="#sec-julia-higher-order"><span class="header-section-number">2.4.6</span> Higher-order functions</a></li>
  <li><a href="#do-syntax" id="toc-do-syntax" class="nav-link" data-scroll-target="#do-syntax"><span class="header-section-number">2.4.7</span> do syntax</a></li>
  <li><a href="#composition-and-pipes" id="toc-composition-and-pipes" class="nav-link" data-scroll-target="#composition-and-pipes"><span class="header-section-number">2.4.8</span> Composition and pipes</a></li>
  <li><a href="#generators-and-comprehensions" id="toc-generators-and-comprehensions" class="nav-link" data-scroll-target="#generators-and-comprehensions"><span class="header-section-number">2.4.9</span> Generators and comprehensions</a></li>
  </ul></li>
  <li><a href="#sec-julia-types" id="toc-sec-julia-types" class="nav-link" data-scroll-target="#sec-julia-types"><span class="header-section-number">2.5</span> Types</a>
  <ul class="collapse">
  <li><a href="#type-hierarchy" id="toc-type-hierarchy" class="nav-link" data-scroll-target="#type-hierarchy"><span class="header-section-number">2.5.1</span> Type hierarchy</a></li>
  <li><a href="#numeric-types" id="toc-numeric-types" class="nav-link" data-scroll-target="#numeric-types"><span class="header-section-number">2.5.2</span> Numeric types</a></li>
  <li><a href="#sec-julia-strings" id="toc-sec-julia-strings" class="nav-link" data-scroll-target="#sec-julia-strings"><span class="header-section-number">2.5.3</span> Strings and symbols</a></li>
  <li><a href="#tuples" id="toc-tuples" class="nav-link" data-scroll-target="#tuples"><span class="header-section-number">2.5.4</span> Tuples</a></li>
  <li><a href="#structs-and-parameterization" id="toc-structs-and-parameterization" class="nav-link" data-scroll-target="#structs-and-parameterization"><span class="header-section-number">2.5.5</span> Structs and parameterization</a></li>
  <li><a href="#mutable-structs" id="toc-mutable-structs" class="nav-link" data-scroll-target="#mutable-structs"><span class="header-section-number">2.5.6</span> Mutable structs</a></li>
  <li><a href="#array-types" id="toc-array-types" class="nav-link" data-scroll-target="#array-types"><span class="header-section-number">2.5.7</span> Array types</a></li>
  <li><a href="#other-collections" id="toc-other-collections" class="nav-link" data-scroll-target="#other-collections"><span class="header-section-number">2.5.8</span> Other collections</a></li>
  <li><a href="#unions-nothing-and-missing" id="toc-unions-nothing-and-missing" class="nav-link" data-scroll-target="#unions-nothing-and-missing"><span class="header-section-number">2.5.9</span> Unions, Nothing, and Missing</a></li>
  <li><a href="#types-of-types-and-value-types" id="toc-types-of-types-and-value-types" class="nav-link" data-scroll-target="#types-of-types-and-value-types"><span class="header-section-number">2.5.10</span> Types of types and value types</a></li>
  <li><a href="#sec-julia-convert-promote" id="toc-sec-julia-convert-promote" class="nav-link" data-scroll-target="#sec-julia-convert-promote"><span class="header-section-number">2.5.11</span> Type conversions and promotions</a></li>
  </ul></li>
  <li><a href="#sec-julia-exceptions" id="toc-sec-julia-exceptions" class="nav-link" data-scroll-target="#sec-julia-exceptions"><span class="header-section-number">2.6</span> Exception handling</a></li>
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation"><span class="header-section-number">2.7</span> Documentation</a></li>
  <li><a href="#sec-julia-linalg" id="toc-sec-julia-linalg" class="nav-link" data-scroll-target="#sec-julia-linalg"><span class="header-section-number">2.8</span> Vectors, matrices, and linear algebra</a>
  <ul class="collapse">
  <li><a href="#building-matrices-and-vectors" id="toc-building-matrices-and-vectors" class="nav-link" data-scroll-target="#building-matrices-and-vectors"><span class="header-section-number">2.8.1</span> Building matrices and vectors</a></li>
  <li><a href="#concatenating-matrices-and-vectors" id="toc-concatenating-matrices-and-vectors" class="nav-link" data-scroll-target="#concatenating-matrices-and-vectors"><span class="header-section-number">2.8.2</span> Concatenating matrices and vectors</a></li>
  <li><a href="#transpose-and-rearrangemenent" id="toc-transpose-and-rearrangemenent" class="nav-link" data-scroll-target="#transpose-and-rearrangemenent"><span class="header-section-number">2.8.3</span> Transpose and rearrangemenent</a></li>
  <li><a href="#submatrices-diagonals-and-triangles" id="toc-submatrices-diagonals-and-triangles" class="nav-link" data-scroll-target="#submatrices-diagonals-and-triangles"><span class="header-section-number">2.8.4</span> Submatrices, diagonals, and triangles</a></li>
  <li><a href="#matrix-and-vector-operations" id="toc-matrix-and-vector-operations" class="nav-link" data-scroll-target="#matrix-and-vector-operations"><span class="header-section-number">2.8.5</span> Matrix and vector operations</a></li>
  <li><a href="#things-best-avoided" id="toc-things-best-avoided" class="nav-link" data-scroll-target="#things-best-avoided"><span class="header-section-number">2.8.6</span> Things best avoided</a></li>
  </ul></li>
  <li><a href="#useful-packages" id="toc-useful-packages" class="nav-link" data-scroll-target="#useful-packages"><span class="header-section-number">2.9</span> Useful packages</a>
  <ul class="collapse">
  <li><a href="#statistics" id="toc-statistics" class="nav-link" data-scroll-target="#statistics"><span class="header-section-number">2.9.1</span> Statistics</a></li>
  <li><a href="#sparse-matrices" id="toc-sparse-matrices" class="nav-link" data-scroll-target="#sparse-matrices"><span class="header-section-number">2.9.2</span> Sparse matrices</a></li>
  <li><a href="#dataframes" id="toc-dataframes" class="nav-link" data-scroll-target="#dataframes"><span class="header-section-number">2.9.3</span> DataFrames</a></li>
  <li><a href="#automatic-differentiation" id="toc-automatic-differentiation" class="nav-link" data-scroll-target="#automatic-differentiation"><span class="header-section-number">2.9.4</span> Automatic differentiation</a></li>
  <li><a href="#plots-and-tables" id="toc-plots-and-tables" class="nav-link" data-scroll-target="#plots-and-tables"><span class="header-section-number">2.9.5</span> Plots and tables</a></li>
  <li><a href="#io" id="toc-io" class="nav-link" data-scroll-target="#io"><span class="header-section-number">2.9.6</span> I/O</a></li>
  <li><a href="#development-tools" id="toc-development-tools" class="nav-link" data-scroll-target="#development-tools"><span class="header-section-number">2.9.7</span> Development tools</a></li>
  </ul></li>
  <li><a href="#macros-and-metaprogramming" id="toc-macros-and-metaprogramming" class="nav-link" data-scroll-target="#macros-and-metaprogramming"><span class="header-section-number">2.10</span> Macros and metaprogramming</a>
  <ul class="collapse">
  <li><a href="#code-as-data" id="toc-code-as-data" class="nav-link" data-scroll-target="#code-as-data"><span class="header-section-number">2.10.1</span> Code as data</a></li>
  <li><a href="#macros" id="toc-macros" class="nav-link" data-scroll-target="#macros"><span class="header-section-number">2.10.2</span> Macros</a></li>
  </ul></li>
  <li><a href="#a-matching-example" id="toc-a-matching-example" class="nav-link" data-scroll-target="#a-matching-example"><span class="header-section-number">2.11</span> A matching example</a>
  <ul class="collapse">
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing"><span class="header-section-number">2.11.1</span> Preprocessing</a></li>
  <li><a href="#matching" id="toc-matching" class="nav-link" data-scroll-target="#matching"><span class="header-section-number">2.11.2</span> Matching</a></li>
  <li><a href="#rules" id="toc-rules" class="nav-link" data-scroll-target="#rules"><span class="header-section-number">2.11.3</span> Rules</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">2.11.4</span> Examples</a></li>
  </ul></li>
  <li><a href="#elements-of-julia-style" id="toc-elements-of-julia-style" class="nav-link" data-scroll-target="#elements-of-julia-style"><span class="header-section-number">2.12</span> Elements of Julia style</a>
  <ul class="collapse">
  <li><a href="#formatting-conventions" id="toc-formatting-conventions" class="nav-link" data-scroll-target="#formatting-conventions"><span class="header-section-number">2.12.1</span> Formatting conventions</a></li>
  <li><a href="#correctness-first" id="toc-correctness-first" class="nav-link" data-scroll-target="#correctness-first"><span class="header-section-number">2.12.2</span> Correctness first</a></li>
  <li><a href="#catch-errors-early" id="toc-catch-errors-early" class="nav-link" data-scroll-target="#catch-errors-early"><span class="header-section-number">2.12.3</span> Catch errors early</a></li>
  <li><a href="#put-it-in-a-small-function" id="toc-put-it-in-a-small-function" class="nav-link" data-scroll-target="#put-it-in-a-small-function"><span class="header-section-number">2.12.4</span> Put it in a (small) function</a></li>
  <li><a href="#keep-the-scope-small" id="toc-keep-the-scope-small" class="nav-link" data-scroll-target="#keep-the-scope-small"><span class="header-section-number">2.12.5</span> Keep the scope small</a></li>
  <li><a href="#respect-interfaces" id="toc-respect-interfaces" class="nav-link" data-scroll-target="#respect-interfaces"><span class="header-section-number">2.12.6</span> Respect interfaces</a></li>
  <li><a href="#dry-dont-repeat-yourself" id="toc-dry-dont-repeat-yourself" class="nav-link" data-scroll-target="#dry-dont-repeat-yourself"><span class="header-section-number">2.12.7</span> DRY (Don’t Repeat Yourself)</a></li>
  <li><a href="#kiss-and-yagni" id="toc-kiss-and-yagni" class="nav-link" data-scroll-target="#kiss-and-yagni"><span class="header-section-number">2.12.8</span> KISS and YAGNI</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../00-Background/00-Intro.html">Background Plus a Bit</a></li><li class="breadcrumb-item"><a href="../00-Background/01-Julia.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Julia programming</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-julia-ch" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Julia programming</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Entering this chapter, we assume you have written code in some other languages, but not programmed much (or at all) <em>in <a href="https://julialang.org/">Julia</a></em>, the language that we will use for the code in this book. Julia is a relatively young language initially released in 2012. In comparison the first releases of MATLAB and Python were 1984 and 1991, respectively. Despite its relative youth, Julia has become popular in scientific computing for its speed, simple MATLAB-like matrix syntax, and support for a variety of programming paradigms. Among other reasons, we will use Julia for our codes because</p>
<ul>
<li><p>Julia has strong support for interactive computation, similar to Python, R, or MATLAB. I can try things out on a regular command line, or inside a code editor like <a href="https://code.visualstudio.com/">VSCode</a>, or in a notebook environment (using <a href="https://jupyter.org/">Jupyter</a> or <a href="https://plutojl.org/">Pluto</a>).</p></li>
<li><p>Carefully written Julia code can run as fast as codes written in C, C++, or Fortran.</p></li>
<li><p>Like MATLAB or modern Fortran, Julia provides a concise and convenient syntax for linear algebra computations. Julia also provides native support for Unicode, which is nice for writing mathematics in code the same as one would write it on paper.</p></li>
<li><p>Julia has an easy-to-use package manager and a growing ecosystem of useful package. Because so many users of Julia come from scientific computing and data science, there tend to be many good packages for numerical computing.</p></li>
<li><p>Julia treats functions (and closures) as first-class objects and supports a variety of functional programming features.</p></li>
<li><p>Julia has an expressive type system that is useful for code correctness, for writing expressive code via multiple dispatch (different specialized methods with the same name but different type signatures), and for fast execution.</p></li>
<li><p>Julia provides a rich metaprogramming facility, explicitly modeled on Lisp macros. This makes it easy to write Julia programs that write programs, and can be a powerful way to extend the language.</p></li>
</ul>
<p>The rest of this chapter is intended to get you started with Julia. It is not comprehensive, and we recommend that the curious reader explore further with the excellent <a href="https://docs.julialang.org/en/v1/">Julia documentation</a>. But we also includes some treatment of more advanced corners of the language.</p>
<section id="interacting-with-julia" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="interacting-with-julia"><span class="header-section-number">2.1</span> Interacting with Julia</h2>
<p>We can use Julia non-interactively: typing <code>julia filename.jl</code> at the command line will execute any Julia code in the text file <code>filename.jl</code>. But both for developing new code and for learning the language, it is very useful to work with Julia interactively. The two most common approaches are</p>
<ul>
<li><p>Typing <code>julia</code> at the command line will start an interactive Julia session, sometimes known as a <em>read-evaluate-print loop</em> (REPL). One can also start an interactive Julia session from within in some editors, such as Visual Studio.</p></li>
<li><p>One can interact with Julia using a <em>notebook</em> interface, such as Jupyter (likely the most popular) or Pluto. We view notebooks using a web browser.</p></li>
</ul>
<section id="the-julia-prompt" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="the-julia-prompt"><span class="header-section-number">2.1.1</span> The Julia prompt</h3>
<p>Running <code>julia</code> with no arguments takes us to the Julia prompt. From here, we can type and run general Julia code, though for anything too long we would usually write the code in a file. But even typing simple commands can have some surprises!</p>
<p>The <a href="https://docs.julialang.org/en/v1/stdlib/REPL/">Julia prompt</a> supports many of the amentities of modern command prompts, including:</p>
<ul>
<li><p><em>History</em>: One can scroll through past commands using the up and down arrows.</p></li>
<li><p><em>Emacs-style editing</em>: Code typed into the command prompt can be edited using navigation key bindings similar to the Emacs editor. For example, Ctrl-A and Ctrl-E jump to the beginning and end of the current line, Ctrl-K “kills” text (putting it into a buffer called the “kill ring”), and Ctrl-Y retrieves the last line from the kill ring.</p></li>
<li><p><em>Tab completion</em>: Typing a partial command into Julia and then pressing the tab key will lead to Julia either finishing the command (if it is unambiguous). If the completion is ambiguous, pressing tab a second time will produce a list of suggested possible completions (if the completion is ambiguous).</p></li>
</ul>
<p>Julia allows us to use Unicode characters in code, including code written at the command line. The simplest way to enter these characters is to type a LaTeX special character command and then tab; for example <code>\pi</code> followed by tab produces the character <span class="math inline">\(\pi\)</span> (and in Julia, as in mathematics, this represents <span class="math inline">\(3.14159...\)</span> unless superceded by another local definition). While it is possible to use Julia without taking advantage of Unicode, in many cases it is the most concise way of writing expressions. For example, writing <code>isapprox(x, y)</code> or <code>x ≈ y</code> (rendering the approximately equal symbol by tab-completion on <code>\approx</code> are equivalent in functionality. But the latter is certainly shorter and arguably more idiomatic. Several popular editors also have Julia modes that support Unicode via tab-completion of LaTeX commands, including Visual Studio, Emacs, and Vim.</p>
<p>From the Julia prompt, one can also access</p>
<ul>
<li><p><em>Help</em>: We access the help system by typing the <code>?</code> character and then the name of a function (or module, global variable, etc). Tab completion works in the help system as well, both for completing command names and for entering Unicode. For example, typing <code>?\pi</code> followed by a tab will get system help on the constant <span class="math inline">\(\pi\)</span>.</p></li>
<li><p><em>Shell</em>: If we would like to list directories or quickly run other programs, we can access the shell by typing the <code>;</code> character. To exit shell mode, we type the backspace character at an otherwise-empty shell prompt.</p></li>
<li><p><em>Packages</em>: To enter the package manager, we type the <code>]</code> character; when done, we can exit the package manager by typing a backspace, as with shell mode. We will have more to say about the package manager later in this chapter.</p></li>
</ul>
<p>Pressing Ctrl-C lets us break out of a running Julia command. We can exit from Julia by typing <code>exit()</code> at the prompt or pressing Ctrl-D.</p>
</section>
<section id="jupyter-notebooks" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="jupyter-notebooks"><span class="header-section-number">2.1.2</span> Jupyter notebooks</h3>
<p>The <a href="https://jupyter.org/">Jupyter</a> notebook system was first released in 2015 as a multi-language extension to the earlier IPython notebooks. The Jupyter system supports “computational notebooks” built from cells containing text documentation written in Markdown; code written in Julia or another supported language; and code outputs, which may include both text and graphics. Early versions of Jupyter supported Julia, Python, and R (hence the name),though support for many other languages has been added since. In 2018, a more full-featured environment called JupyterLab was released, and today lives alongside the “classic” Jupyter notebook interface. Both classic Jupyter and JupyterLab use the same file formats <code>.ipynb</code> files), which may contain all cell types, including computed outputs.</p>
<p>Users typically interact with Jupyter through a web browser interface, though there is also support for working with Jupyter notebooks in editors like Visual Studio Code and Emacs. An example of a running notebook is shown in <span class="quarto-unresolved-ref">?fig-tbd</span>. The actual computations for a Jupyter noteook run in a separate “kernel” that communicates with the web browser via a network protocol. The kernel and the brower interface are separate; they may run on the same computer, but are not required to. The kernel responds as though individual cells were typed into the command prompt in the order that the user chooses to execute them, with output then redirected to be shown in the web browser. Because the order of cell execution is chosen by the user, it is not always possible to tell how a notebook arrived at some result just by looking at the output: the user might have executed cells in some unintuitive order, or perhaps a cell was run and then deleted. For this reason, when preparing to save a notebook (whether to share with collaborators or because it is time to quit for the day), we recommend restarting the kernel and re-running all cells from the start so that “what you see is what you get.”</p>
<p>The Julia kernel for Julia is provided in the <a href="https://github.com/JuliaLang/IJulia.jl"><code>IJulia</code></a> package. This can be installed from the Julia command prompt by entering the package mode (by typing <code>]</code> at the prompt) and typing</p>
<pre><code>add IJulia</code></pre>
<p>Once the <code>IJulia</code> package is installed and we have exited back to the normal Julia prompt, we can run Jupyter with a Julia kernel from the Julia prompt by typing</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">IJulia</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>IJulia.<span class="fu">notebook</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Running Jupyter in this way results in a new installation of the Jupyter system, independent of any installations of Jupyter that may already exist on your computer. If you already have Jupyter installed (e.g.&nbsp;as part of a Python installation), you can tell it about the <code>IJulia</code> kernel by making sure the <code>JUPYTER</code> environment variable points to the desired <code>jupyter</code> executable (e.g.&nbsp;by assigning the path to <code>ENV["JUPYTER"]</code> from the Julia prompt), and either running <code>build IJulia</code> at the package prompt, or at the Julia prompt running</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">IJulia</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">installkernel</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once the kernel is installed, one can start Jupyter as normal (e.g.&nbsp;by typing <code>jupyter lab</code> at the shell), and then select the Julia kernel when starting a new notebook or loading an existing one.</p>
</section>
<section id="pluto-notebooks" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="pluto-notebooks"><span class="header-section-number">2.1.3</span> Pluto notebooks</h3>
<p>The <a href="https://plutojl.org/">Pluto</a> notebook is a Julia-specific take on the computational notebook concept. As with Jupyter, the user interacts with Julia computations through a web interface, with computations executing in a separate Julia process. However, there are several key differences between the two systems:</p>
<ul>
<li><p>Pluto does not distinguish between “code cells” and “documentation cells.” The Pluto equivalent of a documentation cell is a code cell that renders Markdown text, which is then displayed as the cell output.</p></li>
<li><p>A single Pluto cell can only contain one statement, though this includes things like function definitions or <code>begin</code>/<code>end</code> blocks.</p></li>
<li><p>Pluto maintains a <em>dependency graph</em> between cells that is used to determine execution order. If cell A defines a symbol that is used within cell B, then executing any update to cell A will also trigger an update of cell B, along with any other cells that depend on cell A, whether directly or indirectly. This mostly addresses the issue of uncertain execution order that sometimes causes headaches for Jupyter users. However, the dependency graph construction is not perfect, and can sometimes be confused by too-clever macros. When this happens, or when there is a change in the packages used by a Pluto notebook, it is usually a good idea to recompute the whole notebook from scratch.</p></li>
<li><p>Pluto notebooks are saved as regular Julia files, with special comments to delimit the cells and indicate the order in which they are displayed. Within the file, the cells are ordered according to the depencency graph, so that a Pluto notebook can also be run as an ordinary Julia program.</p></li>
</ul>
</section>
</section>
<section id="simple-expressions" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="simple-expressions"><span class="header-section-number">2.2</span> Simple expressions</h2>
<p>We start our deeper dive into Julia with a treatment of simple expressions, the very simplest of which are literals (<a href="#tbl-julia-num-literals" class="quarto-xref">Table&nbsp;<span>2.1</span></a>).</p>
<div id="tbl-julia-num-literals" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-julia-num-literals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: Examples of literals in Julia
</figcaption>
<div aria-describedby="tbl-julia-num-literals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Int</code></td>
<td><code>123</code>, <code>1_234</code></td>
</tr>
<tr class="even">
<td><code>UInt</code></td>
<td><code>0x7B</code>, <code>0o173</code> <code>0b1111011</code></td>
</tr>
<tr class="odd">
<td><code>Float64</code></td>
<td><code>10.1</code>, <code>10.1e0</code>, <code>1.01e1</code></td>
</tr>
<tr class="even">
<td><code>Float32</code></td>
<td><code>10.1f0</code>, <code>1.01f1</code></td>
</tr>
<tr class="odd">
<td><code>Logical</code></td>
<td><code>true</code>, <code>false</code></td>
</tr>
<tr class="even">
<td><code>Char</code></td>
<td><code>'c'</code></td>
</tr>
<tr class="odd">
<td><code>String</code></td>
<td><code>"string"</code></td>
</tr>
<tr class="even">
<td><code>Symbol</code></td>
<td><code>:symbol</code></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Ordinary decimal integer expressions (e.g.&nbsp;<code>123</code>) are interpreted as type <code>Int</code>, the system signed integer type. In principle, this will be 32-bit or 64-bit depending on the preferred default integer size for the system. In practice, most current systems are 64-bit. Unsigned integer literals can be written in hexadecimal, octal, or binary; these listerals default to the smallest type that will contain them. Floating point literals default to 64-bit, unless an exponent is included. For both integer and floating point types, underscores can be included on input as spacers; that is, <code>1_234</code> and <code>1234</code> are interpreted the same way.</p>
<p>In addition to standard numerical literals, Julia provides a few constants, including <span class="math inline">\(\pi\)</span> and <span class="math inline">\(e\)</span>; we type Unicode symbols for these with tab completion on <code>\pi</code> and <code>\euler</code>. There are also special constants for exceptional floating point values. For example, <code>Inf</code> or <code>Inf64</code> denote double-precision floating point infinity and <code>NaN</code> or <code>NaN64</code> denote double-precision not-a-number encodings; the single-precision (32-bit) analogues are <code>Inf32</code> and <code>NaN32</code>.</p>
<p>Julia supports string literals surrounded by either single quotes or triple quotes. Triple-quoted strings can include regular quote characters and newlines with no special characters, e.g.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>box_quote <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">"All models are wrong, but some models are useful."</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">    -- George Box"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Julia characters correspond to Unicode codepoints, and strings likewise use Unicode encodings. In particular, Julia string literals are represented in program code and in memory using UTF-8, which defines a variable-length encoding for characters. This leads to some complexities in Julia string processing, which we address in <a href="#sec-julia-strings" class="quarto-xref"><span>Section 2.5.3</span></a>.</p>
<p>A <em>symbol</em> in Julia is represented in memory as a special type of string that is entered in a global dictionary for fast comparisons. Symbols can be used like strings that admit particularly fast comparison, but they are more important for the role that they play in metaprogramming, where evaluating a symbol corresponds to evaluating a variable named in the program.</p>
<section id="assignment-scopes-and-variable-types" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="assignment-scopes-and-variable-types"><span class="header-section-number">2.2.1</span> Assignment, scopes, and variable types</h3>
<p>Like many other languages, the Julia assignment operation <code>=</code> represents binding a name to a value. For example,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>assigns a name <code>x</code> to the value <code>10</code>. Julia also allows <em>destructuring</em> assignments in which an ordered collection (a tuple or vector) is unpacked into multiple outputs, e.g.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>L, U, p <span class="op">=</span> <span class="fu">lu</span>(A)  <span class="co"># Assign multiple outputs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There is also a form of destructuring assignment for when the right hand side has named quantities, e.g.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> (x <span class="op">=</span> <span class="fl">1.0</span>, y <span class="op">=</span> <span class="fl">2.0</span>, z <span class="op">=</span> <span class="fl">3.0</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>(; y, z) <span class="op">=</span> p  <span class="co"># Sets y = p.y, z = p.z</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This format works for named tuples and for structures.</p>
<p>What is more complicated is the <em>scope</em>, i.e.&nbsp;the part of the code in which this assignment holds.</p>
<section id="scope" class="level4" data-number="2.2.1.1">
<h4 data-number="2.2.1.1" class="anchored" data-anchor-id="scope"><span class="header-section-number">2.2.1.1</span> Scope</h4>
<p><em>Global</em> variables in Julia belong to a “top-level” namespace called the <em>global scope</em>. Technically, there is a separate global scope for each <em>module</em>, as we will describe in more detail in <span class="quarto-unresolved-ref">?sec-tbd</span>. But when we start a Julia session, we are working with a new (anonymous) module with its own global scope, and when we refer to “the” global scope, this is the namespace that we mean.</p>
<p>Certain types of code blocks create new <em>local scopes</em>, or variable namespaces with bindings that are only meaningful inside the code block. Julia is <em>lexically scoped</em>, so the visibility of variable bindings depends on the code structure, not the execution path through the code. Local scopes can (and often are) nested. The <code>let</code> statement in Julia serves the sole purpose of creating a new scope with local bindings; for example:</p>
<div id="1c56c4b9" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fl">0</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> p <span class="op">=</span> <span class="fl">1</span>      <span class="co"># New version of p</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">println</span>(p) <span class="co"># Prints 1 (p from inner scope)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(p)   <span class="co"># Prints 0 (p from outer scope)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
0</code></pre>
</div>
</div>
<p>The <code>let</code> statement actually has two parts:</p>
<ul>
<li>A series of assignment statements on the same line as the <code>let</code>, which result in bindings of variable names that are purely local to the <code>let</code>;</li>
<li>A code block that by default makes use of the bindings in the assignment block <em>and</em> any bindings in the outer scope.</li>
</ul>
<p>The difference can be somewhat subtle. For example, a single newline can change the semantics of the previous example by moving the assignment <code>p=0</code> from the assignment block of the <code>let</code> (where it creates a new version of <code>p</code>) to the code block of the <code>let</code> (where it re-binds the symbol <code>p</code> from the enclosing scope):</p>
<div id="44941894" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fl">0</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fl">1</span>      <span class="co"># Reassign outer version of p</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">println</span>(p) <span class="co"># Prints 1</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(p)   <span class="co"># Prints 1 again</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
1</code></pre>
</div>
</div>
<p>At the same time, we can use the <code>local</code> keyword to make a version of the variable that is explicitly local to the <code>let</code> code block:</p>
<div id="4da17a46" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fl">0</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> p <span class="op">=</span> <span class="fl">1</span>  <span class="co"># Create local version of p</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">println</span>(p)   <span class="co"># Prints 1</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(p)   <span class="co"># Prints 0</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
0</code></pre>
</div>
</div>
<p>Julia distinguishes between constructs that create “hard” local scopes (such as function and macro definitions or the assignment part of <code>let</code> blocks) and those that create “soft” local scopes (such as loops, conditionals, the code part of <code>let</code> statements, and <code>try</code> blocks), with the two differing in their treatment of assignments to existing names. For example, a <code>for</code> statement establishes a soft local scope, in which assignments to existing variables in enclosing scopes do not create a shadow variable:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">do_more_stuff</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fl">0</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> k    <span class="co"># x is the same variable as before</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(x)   <span class="co"># Prints 5</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, if <code>x</code> were not declared before the <code>for</code> loop, the version inside the loop body would be purely local to the loop:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">do_more_stuff</span>()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> k    <span class="co"># x is local to this iteration</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(x)   <span class="co"># Error -- x doesn't exist here!</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In any local scope, we can explicitly declare that we want to use a global variable. For example:</p>
<div id="be0299c1" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">modify_global_xyz</span>()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    xyz <span class="op">=</span> <span class="fl">0</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">global</span> xyz</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        xyz <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">modify_global_xyz</span>()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(xyz) <span class="co"># Prints 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1</code></pre>
</div>
</div>
<p>However, if we try to assign to a global variable name in a local scope without using the <code>global</code> keyword, different things will happen depending not only on whether the local scope is “hard” or “soft,” but also on whether we are in an interactive session or running code non-interactively:</p>
<ul>
<li><p>Hard local scope: Always create a shadow of the global variable.</p></li>
<li><p>Soft local scope: If interactive, assign to the global variable. Otherwise, create a shadow variable and issue a warning to the user.</p></li>
</ul>
</section>
<section id="sec-julia-var-types" class="level4" data-number="2.2.1.2">
<h4 data-number="2.2.1.2" class="anchored" data-anchor-id="sec-julia-var-types"><span class="header-section-number">2.2.1.2</span> Variable types</h4>
<p>All <em>values</em> in Julia have concrete types. When a <em>variable</em> in Julia is given a type, it restricts the types of values that can be assigned to the variable to only those that are compatible. For example, if we would like <code>x</code> to represent a floating point number, we could write:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">::</span><span class="dt"> Float64 </span><span class="op">=</span> <span class="fl">0</span>  <span class="co"># Implicitly converts the integer 0 to the floating point 0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once the type of <code>x</code> has been specified, we cannot assign an incompatible value to <code>x</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">::</span><span class="dt"> Float64 </span><span class="op">=</span> <span class="fl">0</span>  <span class="co"># OK so far, x is now floating point 0.0</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">"Oops"</span>        <span class="co"># Error!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Though values must have concrete types, we can give variables <em>abstract</em> types. For example, Julia has many numeric types, all of which are subtypes of type <code>Number</code>. We can assign any numeric value to a variable declared to have type <code>Number</code>, but non-numeric values are not allowed:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">::</span><span class="dt"> Number </span><span class="op">=</span> <span class="fl">0</span>   <span class="co"># OK, x is now Int(0), and Int is a subtype of Number</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">0.0</span>           <span class="co"># Still OK, Float64 is a subtype of Number</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">"Oops"</span>        <span class="co"># Error!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will have much more to say about types in <span class="quarto-unresolved-ref">?sec-tbd</span>.</p>
</section>
</section>
<section id="arithmetic-operations" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="arithmetic-operations"><span class="header-section-number">2.2.2</span> Arithmetic operations</h3>
<div id="tbl-arith-operations" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arith-operations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.2: Standard arithmetic operations
</figcaption>
<div aria-describedby="tbl-arith-operations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Syntax</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>+x</code></td>
<td>Unary plus (identity)</td>
</tr>
<tr class="even">
<td><code>-x</code></td>
<td>Unary minus</td>
</tr>
<tr class="odd">
<td><code>x + y</code></td>
<td>Addition</td>
</tr>
<tr class="even">
<td><code>x - y</code></td>
<td>Subtraction</td>
</tr>
<tr class="odd">
<td><code>x * y</code></td>
<td>Multiplication</td>
</tr>
<tr class="even">
<td><code>x / y</code></td>
<td>Division</td>
</tr>
<tr class="odd">
<td><code>x ÷ y</code></td>
<td>Integer division</td>
</tr>
<tr class="even">
<td><code>x \ y</code></td>
<td>Inverse divide (<span class="math inline">\(\equiv\)</span> <code>y/x</code>)</td>
</tr>
<tr class="odd">
<td><code>p // q</code></td>
<td>Rational construction</td>
</tr>
<tr class="even">
<td><code>x ^ y</code></td>
<td>Power</td>
</tr>
<tr class="odd">
<td><code>x % y</code></td>
<td>Remainder</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>We show some of the standard Julia arithmetic operations in <a href="#tbl-arith-operations" class="quarto-xref">Table&nbsp;<span>2.2</span></a>. These mostly behave similarly to other languages, but with some subtleties around division. In particular:</p>
<ul>
<li><p>The ordinary division operator produces a floating point result even when the inputs are integers and the result is exactly representable as an integer. For example, <code>6/3</code> yields <code>2.0</code>.</p></li>
<li><p>Integer division always rounds toward zero; for example, <code>14 ÷ 5</code> yields <code>2</code>, while <code>-14 ÷ 5</code> yields <code>-2</code>. The remainder operation is consistent with integer division.</p></li>
<li><p>Integer division and remainder can also be used with non-integer types; for example, <code>14.1 ÷ 5</code> yields <code>2.0</code>, and <code>14.1 % 5</code> yields <code>4.1</code>.</p></li>
<li><p>The backslash (inverse divide) operation can be used with any numeric types, but is most frequently used in the context of linear algebra. When <code>A</code> and <code>b</code> are a matrix and a vector, we use <code>A\b</code> to compute <span class="math inline">\(A^{-1} b\)</span> without computing an explicit inverse.</p></li>
<li><p>The construct <code>p // q</code> is used to construct a <em>rational</em> number. The numerator and denominator must be integers.</p></li>
</ul>
<p>Julia also allows for implicit multiplication when a literal number (integer or floating point) precedes a symbol with no space. For example, <code>2.0im</code> produces a complex floating point value equal to <span class="math inline">\(2i\)</span>.</p>
<p>There are <em>updating</em> operations of all the arithmetic operations (except for rational construction), formed by combining the operation name with an equal sign. These are essentially equivalent to a binary operation followed by an assignment; for example,</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">+=</span> <span class="fl">1</span>  <span class="co"># Equivalent to x = x + 1</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">*=</span> <span class="fl">2</span>  <span class="co"># Equivalent to x = x * 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="logical-operations" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="logical-operations"><span class="header-section-number">2.2.3</span> Logical operations</h3>
<p>Julia supports the usual logical and <code>p &amp;&amp; q</code>, or <code>p || q</code>, and <code>!p</code> constructions. The arguments to these operations must be logical; unlike some languages, we cannot interpret integers or lists as logical values, for example. The and and or operators are <em>short-circuited</em>, meaning that the second argument is only executed if the first argument is insufficient to determine the truth value. For example, consider the code fragment</p>
<div id="538aec14" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="cn">true</span> <span class="op">||</span> <span class="cf">begin</span> <span class="fu">println</span>(<span class="st">"Hello 1"</span>); <span class="cn">true</span> <span class="cf">end</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="cn">false</span> <span class="op">||</span> <span class="cf">begin</span> <span class="fu">println</span>(<span class="st">"Hello 2"</span>); <span class="cn">true</span> <span class="cf">end</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    x, y</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello 2</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>(true, true)</code></pre>
</div>
</div>
<p>Both <code>x</code> and <code>y</code> are assigned to be true, but only the string <code>"Hello 2"</code> is printed.</p>
<p>Julia also supports a ternary <em>conditional</em> operator: <code>p ? x : y</code> evaluates <code>p</code> and returns either <code>x</code> or <code>y</code> depending whether <code>p</code> is true or false, respectively. Like the logical and and or, the ternary conditional operator is short-circuiting; only one of the <code>x</code> and <code>y</code> clauses will be evaluated. The conditional operator is equivalent to a Julia <code>if</code> statment; that is, these two statements do the same thing:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>z1 <span class="op">=</span> p ? x <span class="op">:</span> y</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>z2 <span class="op">=</span> <span class="cf">if</span> p then x <span class="cf">else</span> y <span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="comparisons" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="comparisons"><span class="header-section-number">2.2.4</span> Comparisons</h3>
<p>Julia provides several different comparison operations. Most types support tests for structural equality (<code>==</code>) or inequality (<code>!=</code> or <code>≠</code>). This is a forgiving sort of test, allowing for things like promotion of the arguments to a common type. For example, all the following expressions evaluate to <code>true</code>:</p>
<div id="b5acdf92" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1</span> <span class="op">==</span> <span class="fl">1</span>   <span class="op">&amp;&amp;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1</span> <span class="op">!=</span> <span class="fl">2</span>   <span class="op">&amp;&amp;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fl">2</span> <span class="op">==</span> <span class="fl">2.0</span> <span class="op">&amp;&amp;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>[<span class="fl">1</span>; <span class="fl">2</span>] <span class="op">==</span> [<span class="fl">1.0</span>; <span class="fl">2.0</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>true</code></pre>
</div>
</div>
<p>The substitutional equality operation (<code>===</code>) and inequality operation (<code>!==</code>) test whether two entities are <em>indistinguishable</em>. This is usually a more restrictive notion of equality. For example, all the following expressions evaluate to <code>true</code>:</p>
<div id="c7abb5ce" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1</span> <span class="op">===</span> <span class="fl">1</span>  <span class="op">&amp;&amp;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1</span> <span class="op">!==</span> <span class="fl">2</span>  <span class="op">&amp;&amp;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fl">2</span> <span class="op">!==</span> <span class="fl">2.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>true</code></pre>
</div>
</div>
<p>Values that correspond to <em>mutable</em> objects never satisfy <code>===</code>, unless they are exactly the same object. For example, Julia allows us to change the contents of an array (it is <em>mutable</em>), but not the contents of a string (it is <em>immutable</em>). Therefore, both the following expressions are <code>true</code>:</p>
<div id="34402da5" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="st">"12"</span> <span class="op">===</span> <span class="st">"12"</span>  <span class="op">&amp;&amp;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>[<span class="fl">1</span>; <span class="fl">2</span>] <span class="op">!==</span> [<span class="fl">1</span>; <span class="fl">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>true</code></pre>
</div>
</div>
<p>For the most part, substitutional equality implies structural equality, but not vice-versa. We say “for the most part” because of the example of the default <em>not-a-number</em> (<code>NaN</code>). According to the standard floating point semantics (<a href="../01-Fund1d/02-Arithmetic.html" class="quarto-xref"><span>Chapter 9</span></a>), not-a-number is not equal to anything in the floating point system, including itself. But the <code>NaN</code> symbol does satisfy substitutional equality. Therefore, both the following are <code>true</code>:</p>
<div id="c535b8e2" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cn">NaN</span> <span class="op">!=</span> <span class="cn">NaN</span>  <span class="op">&amp;&amp;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="cn">NaN</span> <span class="op">===</span> <span class="cn">NaN</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>true</code></pre>
</div>
</div>
<p>We will have more to say about the vagaries of floating point equality when we get to <a href="../01-Fund1d/02-Arithmetic.html" class="quarto-xref"><span>Chapter 9</span></a>. For now we simply mention that Julia also supports an <em>approximate</em> equality operation that can be used for comparing whether floating point quantities are within some tolerance of each other. For example, the following statements are both <code>true</code>:</p>
<div id="df69fe00" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0</span> <span class="op">≈</span> <span class="fl">1.00000001</span> <span class="op">&amp;&amp;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0</span> <span class="op">≠</span> <span class="fl">1.00000001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>true</code></pre>
</div>
</div>
<p>In addition to testing for equality or inequality, we can test <em>ordered</em> types with <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code> (or <code>≤</code>), and <code>&gt;=</code> (or <code>≥</code>). Ordered types include integers, floating point numbers, strings, symbols, and logicals. For strings and symbols, we use <em>lexicographic</em> ordering (aka alphabetic ordering); for logicals, we have <code>false &lt; true</code>.</p>
<div id="ba11b7ed" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">:</span>a <span class="op">&lt;</span> <span class="op">:</span>b   <span class="op">&amp;&amp;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="st">"a"</span> <span class="op">&lt;</span> <span class="st">"b"</span> <span class="op">&amp;&amp;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="cn">false</span> <span class="op">&lt;</span> <span class="cn">true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>true</code></pre>
</div>
</div>
</section>
<section id="simple-calls" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="simple-calls"><span class="header-section-number">2.2.5</span> Simple calls</h3>
<p>Simple calls in Julia have the form <code>function_name(args)</code>. The arguments are comma-separated, starting with any <em>positional</em> arguments followed by any <em>keyword</em> arguments. Julia uses the types of the provided positional arguments to distinguish between different <em>methods</em> with the same name and number of arguments. Most operators in Julia are just a thin layer of “syntactic sugar” that hide ordinary method calls. For example, writing <code>1+2</code> and <code>+(1,2)</code> are equivalent; but <code>1+2</code> and <code>1.0+2.0</code> invoke different methods, since the types are different (both <code>Int</code> for the former expression, both <code>Float64</code> in the latter).</p>
<p>A call may provide only the leading positional arguments if the remaining arguments are assigned default values. Keyword arguments always have a default value. For example, the linear algebra routine <code>cholesky</code> takes positional arguments: a matrix <code>A</code> and a flag variable that indicates whether the computation should use pivoting or not (defaulting to <code>NoPivot()</code>). In addition, Cholesky takes a logical keyword argument <code>check</code> that indicates whether the routine should produce an exception on failure (<code>check == true</code>, the default) or should produce no exception (<code>check == false</code>). Therefore, all the following are valid calls to <code>cholesky</code></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="fu">cholesky</span>(A)  <span class="co"># without pivoting, check result</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="fu">cholesky</span>(A, check<span class="op">=</span><span class="cn">false</span>)  <span class="co"># without pivot, no check</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="fu">cholesky</span>(A, <span class="fu">RowMaximum</span>()) <span class="co"># pivoted, check result</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="fu">cholesky</span>(A, <span class="fu">RowMaximum</span>(), check<span class="op">=</span><span class="cn">false</span>), <span class="co"># pivot, no check</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Julia passes arguments using a “call-by-sharing” convention, in which names within the function are bound to the values passed in. This means that if a mutable value (e.g.&nbsp;an array) is passed as an argument to a function, the function is allowed to modify that argument. By convention, functions that modify their arguments end with an exclamation mark. For example, calling <code>cholesky(A)</code> function produces a new output matrix and leaves <code>A</code> alone, while <code>cholesky!(A)</code> modifies the matrix <code>A</code>.</p>
<p>Sometimes, it is convenient to package the positional arguments to a function into a tuple. A tuple can be <em>unpacked</em> into an argument list by following it with <code>...</code>, sometimes called the <em>splat</em> operation. This is sometimes useful in function calls; for example</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> (<span class="fl">1.0</span>, <span class="fl">1.00000001</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">isapprox</span>(a<span class="op">...</span>)      <span class="co"># Same as isapprox(1.0, 1.00000001)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While it is mostly used for calling, Julia does also allow this sort of unpacking in other contexts than function calls; for example</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> (a, <span class="fl">2</span>)          <span class="co"># Yields ((1.0, 1.00000001), 2)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>bunpack <span class="op">=</span> (a<span class="op">...</span>, <span class="fl">2</span>) <span class="co"># Yields (1.0, 1.00000001, 2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="broadcasting-operations" class="level3" data-number="2.2.6">
<h3 data-number="2.2.6" class="anchored" data-anchor-id="broadcasting-operations"><span class="header-section-number">2.2.6</span> Broadcasting operations</h3>
<p>Function calls and operations can be applied elementwise to arrays using broadcasting syntax. This involves putting a dot before the operator name or after the function name. For example: <code>{.julia} θs = [0; π/4; π/2; 3π/4; π] cos.(θs) # [1; sqrt(2)/2; 0; -sqrt(2)/2; -1] θs .+ 1 # [1; π/4+1; π/2+1; 3π/4+1; π+1]</code> The <code>@.</code> macro can be used to “dot-ify” everything in an expression, e.g.&nbsp;<code>{.julia} xs = range(0, 1, length=100) y = @. xs^2 + 2xs + 1.0</code> evaluates the map <span class="math inline">\(x \mapsto x^2 + 2x + 1\)</span> to every element of the vector <code>xs</code>.</p>
<p>Vectorized operations are critical to performance in some languages. In Julia, they are not so performance critical. However, they are convenient for concise code.</p>
</section>
<section id="indexing-and-slicing" class="level3" data-number="2.2.7">
<h3 data-number="2.2.7" class="anchored" data-anchor-id="indexing-and-slicing"><span class="header-section-number">2.2.7</span> Indexing and slicing</h3>
<p>Square brackets are used to access elements of an array or similar object,or to refer to sub-arrays of an array (slices). Indices are one-based; and in the context of indexing, the symbol <code>end</code> refers to the final index. For example,</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> [<span class="fl">5</span>; <span class="fl">2</span>; <span class="fl">2</span>; <span class="fl">3</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lst[<span class="fl">2</span>]        <span class="co"># Evaluates to 2</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>lst[<span class="kw">end</span>]      <span class="co"># Evaluates to 3</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>lst[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>]      <span class="co"># Evaluates to [5; 2]</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>lst[[<span class="fl">2</span>; <span class="fl">1</span>]]   <span class="co"># Evaluates to [2; 5]</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>lst[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]    <span class="co"># Evaluates to [2; 2; 3]</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>lst[<span class="fl">2</span><span class="op">:</span><span class="fl">3</span>] <span class="op">.=</span> <span class="fl">4</span> <span class="co"># Now lst is [5; 4; 4; 3]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can index into an array to either get elements or subarrays or to assign to them. When getting elements or subarrays, the default behavior is to get a copy of the extracted data; so, for example</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> [<span class="fl">5</span>; <span class="fl">2</span>; <span class="fl">2</span>; <span class="fl">3</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sublst <span class="op">=</span> lst[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>]    <span class="co"># New storage for sublst</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>sublist[<span class="op">:</span>] <span class="op">=</span> [<span class="fl">3</span>; <span class="fl">4</span>]  <span class="co"># Changes contents of sublst, not lst</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we want to modify a subarray in the main array from which it was extracted, we can use a <em>view</em>. A <em>view</em> has its own indexing, but uses the storage of another object. For example:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> [<span class="fl">5</span>; <span class="fl">2</span>; <span class="fl">2</span>; <span class="fl">3</span>]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>sublst <span class="op">=</span> <span class="fu">view</span>(lst, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>)  <span class="co"># Provides a view into lst</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>sublist[<span class="op">:</span>] <span class="op">=</span> [<span class="fl">3</span>; <span class="fl">4</span>]      <span class="co"># lst is now [3; 4; 2; 3]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We frequently provide indices that are integers (to get individual elements) or arrays of integers (whether ranges like <code>1:2</code> or concrete index lists like <code>[1 4 2]</code>). But we can also use <em>logical</em> indexing, in which an iterable boolean list tells us whether the corresponding entry should be kept in the result or excluded. For example:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> [<span class="fl">5</span>; <span class="fl">2</span>; <span class="fl">2</span>; <span class="fl">3</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>idx_big <span class="op">=</span> (lst <span class="op">.&gt;</span> <span class="fl">2</span>)  <span class="co"># [true, false, false, true]</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>lst[idx_big]          <span class="co"># Results in [5; 3]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In some circumstances, we also have index spaces that are fundamentally non-integer (or can be). An example is with <em>named tuples</em>, which can be accessed either by indexing positionally or by name. For example, consider the following tuple:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>xyz <span class="op">=</span> (x<span class="op">=</span><span class="fl">4</span>, y<span class="op">=</span><span class="fl">5</span>, z<span class="op">=</span><span class="fl">6</span>)  <span class="co"># Create a named tuple</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>xyz[<span class="fl">1</span>]                 <span class="co"># Returns 4 (the value of x)</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>xyz[<span class="op">:</span>y]                <span class="co"># Returns 5 (the value of y)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Our examples so far have been for single-index arrays (vectors), but everything generalizes natural to multi-dimensional arrays.</p>
</section>
<section id="structure-access" class="level3" data-number="2.2.8">
<h3 data-number="2.2.8" class="anchored" data-anchor-id="structure-access"><span class="header-section-number">2.2.8</span> Structure access</h3>
<p>Several compound data types contain named <em>fields</em>, including record types (defined with the <code>struct</code> keyword) and named tuples (mentioned in the previous section). These fields can be accessed with the syntax <code>val.field</code>. For example, consider again the <code>xyz</code> tuple from the previous example:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>xyz <span class="op">=</span> (x<span class="op">=</span><span class="fl">4</span>, y<span class="op">=</span><span class="fl">5</span>, z<span class="op">=</span><span class="fl">6</span>)  <span class="co"># Create a named tuple</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>xyz.z                  <span class="co"># Returns 6 (structure access syntax)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Many compound data types are immutable, so that fields cannot be assigned. For those that are mutable, though, we can also use <code>val.field</code> on the left hand side of an assignment statement.</p>
</section>
<section id="strings" class="level3" data-number="2.2.9">
<h3 data-number="2.2.9" class="anchored" data-anchor-id="strings"><span class="header-section-number">2.2.9</span> Strings</h3>
<p>One particularly convenient feature of Julia is <em>string interpolation</em>. For example, consider the following Julia code:</p>
<div id="6519c18e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  sqrt2approx <span class="op">=</span> <span class="fl">99.0</span><span class="op">/</span><span class="fl">70.0</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"The error in sqrt(2)-</span><span class="sc">$</span>sqrt2approx<span class="st"> is </span><span class="sc">$</span>(<span class="fu">sqrt</span>(<span class="fl">2</span>)<span class="op">-</span>sqrt2approx)<span class="st">"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>"The error in sqrt(2)-1.4142857142857144 is -7.215191261922271e-5"</code></pre>
</div>
</div>
<p>In evaluating the string, Julia replaces <code>$sqrt2approx</code> with the value of the variable <code>sqrt2approx</code>, and it replaces <code>$(sqrt(2)-sqrt2approx)</code> with the string representation of the number <code>sqrt(2)-sqrt2approx</code>. For more controlled formatting (e.g.&nbsp;printing only a few digits of the error), the standard recommendation is to use the <code>@sprintf</code> macro from the <code>Printf</code> package.</p>
<p>In addition to building strings by interpolation, Julia lets us build strings by <em>concatentation</em>. The operator <code>*</code> concatenates two strings; for example <code>"Hello " * "world"</code> produces <code>"Hello world"</code>. The <code>^</code> operation on strings can also be used for repetition; for example <code>"Hello "^2</code> produces <code>"Hello Hello "</code>.</p>
</section>
</section>
<section id="control-flow" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="control-flow"><span class="header-section-number">2.3</span> Control flow</h2>
<p>We have already discussed one form of control flow, with short-circuit evaluation of logical and conditional operators. Beyond this, we have conditionals and loops. We treat exception handling in <a href="#sec-julia-exceptions" class="quarto-xref"><span>Section 2.6</span></a>.</p>
<section id="conditional-statements" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="conditional-statements"><span class="header-section-number">2.3.1</span> Conditional statements</h3>
<p>Julia has an <code>if</code>/<code>elseif</code>/<code>else</code>/<code>end</code> statement structure. The statement is actually an expression, which evaluates to whatever branch is taking. For example</p>
<div id="2a4c6e78" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_leap_year</span>(year) <span class="op">=</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year <span class="op">%</span> <span class="fl">400</span> <span class="op">==</span> <span class="fl">0</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>        <span class="cn">true</span> <span class="co"># Multiples of 400 years are leap years</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> year <span class="op">%</span> <span class="fl">100</span> <span class="op">==</span> <span class="fl">0</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        <span class="cn">false</span> <span class="co"># Multiples of 100 years otherwise are not</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> year <span class="op">%</span> <span class="fl">4</span> <span class="op">==</span> <span class="fl">0</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        <span class="cn">true</span>  <span class="co"># Which is an exception to "every fourth year"</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        <span class="cn">false</span> <span class="co"># Otherwise, not a leap year</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If none of the conditions are satisfied and there is no <code>else</code> clause, the result evaluates to <code>nothing</code>.</p>
<p>Unlike loops, <code>if</code> statements do not introduce a local scope.</p>
</section>
<section id="sec-julia-loops" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="sec-julia-loops"><span class="header-section-number">2.3.2</span> Loops</h3>
<p>A <code>while</code> loop executes while the loop condition is true</p>
<div id="5086db39" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gcd</span>(a,b)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> b <span class="op">!=</span> <span class="fl">0</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> b, a<span class="op">%</span>b</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    a</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A <code>for</code> loop iterates over a collection. Perhaps most frequently, this is an integer range:</p>
<div id="17ab8d2c" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mydot</span>(x, y)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@assert</span> <span class="fu">length</span>(x) <span class="op">==</span> <span class="fu">length</span>(y)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(x)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> x[i]<span class="fu">*conj</span>(y[i])</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    result</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, we can also iterate over other collections, whether they are concrete or abstract. For example, the <code>zip</code> function creates an abstract collection of tuples constructed from elements of parallel lists:</p>
<div id="5fe66606" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mydot2</span>(x, y)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@assert</span> <span class="fu">length</span>(x) <span class="op">==</span> <span class="fu">length</span>(y)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (xi, yi) <span class="kw">in</span> <span class="fu">zip</span>(x, y)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="fu">xi*conj</span>(yi)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    result</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <code>for</code> loop syntax, we can use <code>=</code>, <code>in</code>, or <code>∈</code> between the loop variable name and the collection to be iterated over.</p>
<p>The <code>break</code> statement jumps out of a loop in progress.</p>
<p>Both <code>while</code> loops and <code>for</code> loops produce “soft” local scope: references to already-used names from surrounding scopes will not be shadowed, but any new names will be bound in the local scope.</p>
</section>
</section>
<section id="functions-and-methods" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="functions-and-methods"><span class="header-section-number">2.4</span> Functions and methods</h2>
<section id="defining-functions" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="defining-functions"><span class="header-section-number">2.4.1</span> Defining functions</h3>
<p>Julia provides three primary syntactic variants for defining functions:</p>
<ul>
<li>Using the <code>function</code> keyword</li>
<li>Using an equational definition</li>
<li>Using the <code>-&gt;</code> operator</li>
</ul>
<p>The <code>function</code> keyword is the standard choice for defining complicated functions that might involve several statements. We have seen a few examples already, but for now let’s consider again the Euclidean algorithm for the greatest common denominator, seen in <a href="#sec-julia-loops" class="quarto-xref"><span>Section 2.3.2</span></a>:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gcd</span>(a, b)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> b <span class="op">!=</span> <span class="fl">0</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> b, a<span class="op">%</span>b</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    a</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The defined function <code>gcd</code> takes two positional arguments (<code>a</code> and <code>b</code>). On a function call, the concrete arguments to the call are bound to the names <code>a</code> and <code>b</code> in a local scope, and then the body of the function is then evaluated to obtain a return value. We note that as with other compound statements in Julia (e.g.&nbsp;<code>begin/end</code> blocks and <code>let/end</code> blocks), the value of the function body is the last expression in the body – in this case, the final value of <code>a</code>. We could also write <code>return a</code>, but this is not strictly necessary in this case. In general, <code>return</code> statements are only really needed when we want to exit before reaching the end of a function body.</p>
<p>For short expressions, it is more concise to define functions using Julia’s equational syntax:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">N0</span>(x) <span class="op">=</span> (x<span class="op">-</span><span class="fl">1.0</span>)<span class="fu">*</span>(x<span class="op">-</span><span class="fl">2.0</span>)<span class="fu">*</span>(x<span class="op">-</span><span class="fl">3.0</span>)<span class="op">/</span><span class="fl">6.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The function body on the right-hand side of the function definition can be any valid Julia expression, including a compound statement inside a <code>begin</code>/<code>end</code> constrution. Conventionally, though, we use simple expressions for the function bodies when using this syntax.</p>
<p>Our examples thus far have all involved <em>named</em> functions, but Julia also supports <em>anonymous</em> functions (sometimes called <em>lambdas</em>). We can either write anonymous functions with the <code>function</code> keyword, or using the <code>-&gt;</code> syntax:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="op">=</span> <span class="kw">function</span>(x) x<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span>x <span class="op">+</span> <span class="fl">1</span> <span class="kw">end</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>f2 <span class="op">=</span> x <span class="op">-&gt;</span> x<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span>x <span class="op">+</span> <span class="fl">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The body in the <code>function</code> version is a compound expression ending with <code>end</code>. The body in the <code>-&gt;</code> version is a single expression, similar to what we saw with the equational syntax.</p>
</section>
<section id="defaults-and-keywords" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="defaults-and-keywords"><span class="header-section-number">2.4.2</span> Defaults and keywords</h3>
<p>Most Julia functions take arguments. We can define arguments later in the list to have default values; for example:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">increment</span>(x, amount<span class="op">=</span><span class="fl">1</span>) <span class="op">=</span> x <span class="op">+</span> amount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Default argument values may depend on earlier arguments.</p>
<p>Julia functions can take <em>keyword</em> arguments as well as positional arguments. Keyword arguments must have a default value. In the function definition, a semicolon separates the positional argument list from the keyword argument list. For example, consider the following routine to print a list in sorted order:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">print_sorted</span>(l; by<span class="op">=</span>identity)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> <span class="fu">sort</span>(l, by<span class="op">=</span>by)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> l</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">println</span>(v)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The keyword argument <code>by</code> indicates a function that returns the sort key, and is passed through to the call to the <code>sort</code> function in the first line. We need the semicolon separator in the function definition to distinguish keyword arguments from positional arguments with defaults. However, there is no such requirement when calling the function, so the call to <code>sort</code> only uses commas to separate arguments.</p>
</section>
<section id="sec-julia-closures" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="sec-julia-closures"><span class="header-section-number">2.4.3</span> Closures</h3>
<p>When a Julia function is created inside an enclosing local scope, it may refer to variables that were created inside that scope. In this case, Julia creates a <em>closure</em> of the function definition together with variable bindings from the surrounding environment.</p>
<p>For example, suppose we have a naive Newton iteration for solving a 1D equation <span class="math inline">\(f(x) = 0\)</span>:</p>
<div id="582c0daf" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="st">"""    naive_newton(f, df, x; maxiter=10, ftol=1e-8)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="st">Run Newton iteration to find a zero of `f` </span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="st">(with derivative `df`) from the starting </span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="st">point `x`.  Returns when the magnitude of `f`</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="st">is less than `ftol`, otherwise errors out </span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="st">after running for `maxiter` steps.</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">naive_newton</span>(f, df, x; maxiter<span class="op">=</span><span class="fl">10</span>, ftol<span class="op">=</span><span class="fl">1e-8</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    fx <span class="op">=</span> <span class="fu">f</span>(x)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>maxiter</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">abs</span>(fx) <span class="op">&lt;</span> ftol</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> x</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        x <span class="op">-=</span> fx<span class="op">/</span><span class="fu">df</span>(x)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>        fx <span class="op">=</span> <span class="fu">f</span>(x)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">abs</span>(fx) <span class="op">&lt;</span> ftol</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">error</span>(<span class="st">"Did not converge in </span><span class="sc">$</span>maxiter<span class="st"> steps"</span>)</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We would like to evaluate the list of function values in order to plot the convergence. We could do this by modifying the <code>naive_newton</code> routine, or we could record each call to the function.</p>
<div id="ec67c19c" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_naive_newton</span>(f, df, x; maxiter<span class="op">=</span><span class="fl">10</span>, ftol<span class="op">=</span><span class="fl">1e-8</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a list of values and a closure that </span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># records function evaluations to the list</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    fs <span class="op">=</span> []</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">frecord</span>(x)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>        fx <span class="op">=</span> <span class="fu">f</span>(x)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(fs, fx)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>        fx</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">naive_newton</span>(frecord, df, x, </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>                     maxiter<span class="op">=</span>maxiter, ftol<span class="op">=</span>ftol)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="fu">filter</span>(fx<span class="op">-&gt;</span>fx <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fu">abs</span>.(fs)),</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>         xlabel<span class="op">=</span><span class="st">"k"</span>,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>         yscale<span class="op">=:</span>log10, label<span class="op">=</span><span class="st">"\$f(x_k)\$"</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now a call to <code>plot_naive_newton(sin, cos, 0.5)</code> (for example) will show a plot of the function value magnitudes at each step of the iteration.</p>
<div id="12014e7e" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_naive_newton</span>(sin, cos, <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip120">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip120)" d="M0 1920 L2688 1920 L2688 -4.26326e-14 L0 -4.26326e-14  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip121">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip120)" d="M216.487 1734.12 L2640.76 1734.12 L2640.76 47.2441 L216.487 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip122">
    <rect x="216" y="47" width="2425" height="1688"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="285.099,1734.12 285.099,47.2441 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1047.45,1734.12 1047.45,47.2441 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1809.8,1734.12 1809.8,47.2441 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2572.14,1734.12 2572.14,47.2441 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="216.487,1734.12 2640.76,1734.12 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="285.099,1734.12 285.099,1715.22 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1047.45,1734.12 1047.45,1715.22 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1809.8,1734.12 1809.8,1715.22 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2572.14,1734.12 2572.14,1715.22 "></polyline>
<path clip-path="url(#clip120)" d="M275.481 1794.89 L283.12 1794.89 L283.12 1768.52 L274.81 1770.19 L274.81 1765.93 L283.073 1764.26 L287.749 1764.26 L287.749 1794.89 L295.388 1794.89 L295.388 1798.82 L275.481 1798.82 L275.481 1794.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M1042.1 1794.89 L1058.42 1794.89 L1058.42 1798.82 L1036.48 1798.82 L1036.48 1794.89 Q1039.14 1792.13 1043.72 1787.5 Q1048.33 1782.85 1049.51 1781.51 Q1051.75 1778.98 1052.63 1777.25 Q1053.54 1775.49 1053.54 1773.8 Q1053.54 1771.04 1051.59 1769.31 Q1049.67 1767.57 1046.57 1767.57 Q1044.37 1767.57 1041.92 1768.34 Q1039.48 1769.1 1036.71 1770.65 L1036.71 1765.93 Q1039.53 1764.79 1041.98 1764.21 Q1044.44 1763.64 1046.48 1763.64 Q1051.85 1763.64 1055.04 1766.32 Q1058.23 1769.01 1058.23 1773.5 Q1058.23 1775.63 1057.42 1777.55 Q1056.64 1779.45 1054.53 1782.04 Q1053.95 1782.71 1050.85 1785.93 Q1047.75 1789.12 1042.1 1794.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M1814.04 1780.19 Q1817.4 1780.9 1819.28 1783.17 Q1821.17 1785.44 1821.17 1788.77 Q1821.17 1793.89 1817.65 1796.69 Q1814.14 1799.49 1807.65 1799.49 Q1805.48 1799.49 1803.16 1799.05 Q1800.87 1798.64 1798.42 1797.78 L1798.42 1793.27 Q1800.36 1794.4 1802.68 1794.98 Q1804.99 1795.56 1807.52 1795.56 Q1811.91 1795.56 1814.21 1793.82 Q1816.52 1792.08 1816.52 1788.77 Q1816.52 1785.72 1814.37 1784.01 Q1812.24 1782.27 1808.42 1782.27 L1804.39 1782.27 L1804.39 1778.43 L1808.6 1778.43 Q1812.05 1778.43 1813.88 1777.06 Q1815.71 1775.67 1815.71 1773.08 Q1815.71 1770.42 1813.81 1769.01 Q1811.94 1767.57 1808.42 1767.57 Q1806.5 1767.57 1804.3 1767.99 Q1802.1 1768.4 1799.46 1769.28 L1799.46 1765.12 Q1802.12 1764.38 1804.44 1764.01 Q1806.78 1763.64 1808.84 1763.64 Q1814.16 1763.64 1817.26 1766.07 Q1820.36 1768.47 1820.36 1772.59 Q1820.36 1775.46 1818.72 1777.46 Q1817.08 1779.42 1814.04 1780.19 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2575.15 1768.34 L2563.35 1786.78 L2575.15 1786.78 L2575.15 1768.34 M2573.93 1764.26 L2579.81 1764.26 L2579.81 1786.78 L2584.74 1786.78 L2584.74 1790.67 L2579.81 1790.67 L2579.81 1798.82 L2575.15 1798.82 L2575.15 1790.67 L2559.55 1790.67 L2559.55 1786.16 L2573.93 1764.26 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M1412.8 1833.78 L1418.69 1833.78 L1418.69 1863.03 L1436.17 1847.65 L1443.64 1847.65 L1424.74 1864.33 L1444.44 1883.3 L1436.8 1883.3 L1418.69 1865.89 L1418.69 1883.3 L1412.8 1883.3 L1412.8 1833.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="216.487,1227.96 2640.76,1227.96 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="216.487,642.79 2640.76,642.79 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="216.487,57.6192 2640.76,57.6192 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="216.487,1734.12 216.487,47.2441 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="216.487,1227.96 235.385,1227.96 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="216.487,642.79 235.385,642.79 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="216.487,57.6192 235.385,57.6192 "></polyline>
<path clip-path="url(#clip120)" d="M50.2234 1247.75 L57.8623 1247.75 L57.8623 1221.39 L49.5521 1223.05 L49.5521 1218.8 L57.816 1217.13 L62.4919 1217.13 L62.4919 1247.75 L70.1307 1247.75 L70.1307 1251.69 L50.2234 1251.69 L50.2234 1247.75 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M89.5751 1220.21 Q85.964 1220.21 84.1353 1223.77 Q82.3297 1227.31 82.3297 1234.44 Q82.3297 1241.55 84.1353 1245.11 Q85.964 1248.66 89.5751 1248.66 Q93.2093 1248.66 95.0148 1245.11 Q96.8435 1241.55 96.8435 1234.44 Q96.8435 1227.31 95.0148 1223.77 Q93.2093 1220.21 89.5751 1220.21 M89.5751 1216.5 Q95.3852 1216.5 98.4408 1221.11 Q101.519 1225.69 101.519 1234.44 Q101.519 1243.17 98.4408 1247.78 Q95.3852 1252.36 89.5751 1252.36 Q83.7649 1252.36 80.6862 1247.78 Q77.6307 1243.17 77.6307 1234.44 Q77.6307 1225.69 80.6862 1221.11 Q83.7649 1216.5 89.5751 1216.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M101.519 1210.6 L125.631 1210.6 L125.631 1213.8 L101.519 1213.8 L101.519 1210.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M134.489 1221.08 L140.696 1221.08 L140.696 1199.66 L133.944 1201.01 L133.944 1197.55 L140.658 1196.2 L144.458 1196.2 L144.458 1221.08 L150.664 1221.08 L150.664 1224.28 L134.489 1224.28 L134.489 1221.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M166.463 1198.7 Q163.529 1198.7 162.043 1201.6 Q160.576 1204.47 160.576 1210.27 Q160.576 1216.04 162.043 1218.94 Q163.529 1221.81 166.463 1221.81 Q169.415 1221.81 170.882 1218.94 Q172.368 1216.04 172.368 1210.27 Q172.368 1204.47 170.882 1201.6 Q169.415 1198.7 166.463 1198.7 M166.463 1195.69 Q171.183 1195.69 173.666 1199.43 Q176.167 1203.16 176.167 1210.27 Q176.167 1217.36 173.666 1221.1 Q171.183 1224.82 166.463 1224.82 Q161.742 1224.82 159.24 1221.1 Q156.758 1217.36 156.758 1210.27 Q156.758 1203.16 159.24 1199.43 Q161.742 1195.69 166.463 1195.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M75.5387 662.583 L83.1775 662.583 L83.1775 636.217 L74.8674 637.884 L74.8674 633.624 L83.1312 631.958 L87.8071 631.958 L87.8071 662.583 L95.446 662.583 L95.446 666.518 L75.5387 666.518 L75.5387 662.583 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M114.89 635.036 Q111.279 635.036 109.451 638.601 Q107.645 642.143 107.645 649.272 Q107.645 656.379 109.451 659.944 Q111.279 663.485 114.89 663.485 Q118.525 663.485 120.33 659.944 Q122.159 656.379 122.159 649.272 Q122.159 642.143 120.33 638.601 Q118.525 635.036 114.89 635.036 M114.89 631.333 Q120.7 631.333 123.756 635.939 Q126.835 640.522 126.835 649.272 Q126.835 657.999 123.756 662.606 Q120.7 667.189 114.89 667.189 Q109.08 667.189 106.001 662.606 Q102.946 657.999 102.946 649.272 Q102.946 640.522 106.001 635.939 Q109.08 631.333 114.89 631.333 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M126.835 625.434 L150.946 625.434 L150.946 628.631 L126.835 628.631 L126.835 625.434 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M159.184 611.027 L174.099 611.027 L174.099 614.225 L162.663 614.225 L162.663 621.108 Q163.491 620.826 164.319 620.694 Q165.146 620.544 165.974 620.544 Q170.676 620.544 173.422 623.121 Q176.167 625.697 176.167 630.098 Q176.167 634.631 173.346 637.151 Q170.525 639.653 165.391 639.653 Q163.623 639.653 161.78 639.352 Q159.955 639.051 157.999 638.449 L157.999 634.631 Q159.692 635.553 161.497 636.004 Q163.303 636.455 165.315 636.455 Q168.569 636.455 170.469 634.744 Q172.368 633.032 172.368 630.098 Q172.368 627.164 170.469 625.453 Q168.569 623.741 165.315 623.741 Q163.792 623.741 162.269 624.08 Q160.764 624.418 159.184 625.133 L159.184 611.027 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M105.462 77.4117 L113.101 77.4117 L113.101 51.0461 L104.791 52.7127 L104.791 48.4535 L113.054 46.7868 L117.73 46.7868 L117.73 77.4117 L125.369 77.4117 L125.369 81.3468 L105.462 81.3468 L105.462 77.4117 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M144.813 49.8655 Q141.202 49.8655 139.374 53.4303 Q137.568 56.972 137.568 64.1016 Q137.568 71.208 139.374 74.7728 Q141.202 78.3145 144.813 78.3145 Q148.448 78.3145 150.253 74.7728 Q152.082 71.208 152.082 64.1016 Q152.082 56.972 150.253 53.4303 Q148.448 49.8655 144.813 49.8655 M144.813 46.1619 Q150.624 46.1619 153.679 50.7683 Q156.758 55.3516 156.758 64.1016 Q156.758 72.8284 153.679 77.4348 Q150.624 82.0181 144.813 82.0181 Q139.003 82.0181 135.925 77.4348 Q132.869 72.8284 132.869 64.1016 Q132.869 55.3516 135.925 50.7683 Q139.003 46.1619 144.813 46.1619 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M166.463 28.3579 Q163.529 28.3579 162.043 31.2543 Q160.576 34.1319 160.576 39.9247 Q160.576 45.6986 162.043 48.595 Q163.529 51.4726 166.463 51.4726 Q169.415 51.4726 170.882 48.595 Q172.368 45.6986 172.368 39.9247 Q172.368 34.1319 170.882 31.2543 Q169.415 28.3579 166.463 28.3579 M166.463 25.3486 Q171.183 25.3486 173.666 29.0914 Q176.167 32.8153 176.167 39.9247 Q176.167 47.0152 173.666 50.7579 Q171.183 54.4819 166.463 54.4819 Q161.742 54.4819 159.24 50.7579 Q156.758 47.0152 156.758 39.9247 Q156.758 32.8153 159.24 29.0914 Q161.742 25.3486 166.463 25.3486 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip122)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="285.099,94.9858 1047.45,213.807 1809.8,581.925 2572.14,1686.38 "></polyline>
<path clip-path="url(#clip120)" d="M2201.35 207.153 L2559.95 207.153 L2559.95 103.473 L2201.35 103.473  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2201.35,207.153 2559.95,207.153 2559.95,103.473 2201.35,103.473 2201.35,207.153 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2228.29,155.313 2389.91,155.313 "></polyline>
<path clip-path="url(#clip120)" d="M2440.76 135.239 Q2440.76 136.527 2439.94 137.323 Q2439.14 138.12 2438.13 138.12 Q2437.41 138.12 2436.87 137.675 Q2436.35 137.23 2436.35 136.457 Q2436.35 135.66 2436.96 134.817 Q2437.57 133.974 2438.95 133.857 Q2438.04 132.99 2436.59 132.99 Q2435.86 132.99 2435.25 133.459 Q2434.67 133.904 2434.34 134.63 Q2433.99 135.379 2433.19 139.619 Q2432.93 141.001 2432.7 142.336 Q2432.46 143.671 2432.18 145.076 L2436.17 145.076 Q2436.68 145.076 2436.89 145.1 Q2437.1 145.123 2437.27 145.24 Q2437.45 145.357 2437.45 145.615 Q2437.45 146.271 2437.15 146.435 Q2436.87 146.575 2436.02 146.575 L2431.9 146.575 L2429.02 161.776 Q2428.95 162.221 2428.65 163.627 Q2428.37 165.009 2427.69 167.281 Q2427.01 169.576 2426.33 170.935 Q2425.95 171.708 2425.46 172.434 Q2424.99 173.183 2424.31 173.933 Q2423.63 174.682 2422.74 175.127 Q2421.85 175.596 2420.92 175.596 Q2419.32 175.596 2418.08 174.706 Q2416.84 173.816 2416.84 172.293 Q2416.84 171.005 2417.64 170.209 Q2418.46 169.412 2419.46 169.412 Q2420.19 169.412 2420.71 169.857 Q2421.25 170.302 2421.25 171.075 Q2421.25 171.403 2421.13 171.778 Q2421.01 172.153 2420.75 172.574 Q2420.5 173.019 2419.93 173.324 Q2419.37 173.628 2418.6 173.675 Q2419.51 174.542 2420.92 174.542 Q2421.36 174.542 2421.76 174.354 Q2422.16 174.19 2422.49 173.769 Q2422.84 173.347 2423.1 172.926 Q2423.35 172.527 2423.61 171.754 Q2423.87 171.005 2424.03 170.443 Q2424.2 169.881 2424.41 168.873 Q2424.64 167.866 2424.76 167.257 Q2424.88 166.672 2425.09 165.524 L2428.67 146.575 L2425.51 146.575 Q2424.95 146.575 2424.71 146.552 Q2424.5 146.528 2424.34 146.411 Q2424.17 146.271 2424.17 145.99 Q2424.17 145.545 2424.36 145.357 Q2424.57 145.146 2424.81 145.123 Q2425.04 145.076 2425.6 145.076 L2428.93 145.076 Q2430.05 139.15 2430.5 137.558 Q2431.01 135.871 2431.81 134.7 Q2432.6 133.506 2433.49 132.943 Q2434.39 132.381 2435.11 132.17 Q2435.86 131.936 2436.59 131.936 Q2438.23 131.936 2439.49 132.826 Q2440.76 133.693 2440.76 135.239 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2447.21 153.766 Q2447.21 145.662 2450.24 139.127 Q2451.52 136.386 2453.33 134.091 Q2455.13 131.796 2456.33 130.789 Q2457.52 129.781 2457.85 129.781 Q2458.32 129.781 2458.34 130.25 Q2458.34 130.484 2457.71 131.07 Q2449.98 138.94 2450 153.766 Q2450 168.639 2457.52 176.205 Q2458.34 177.024 2458.34 177.282 Q2458.34 177.751 2457.85 177.751 Q2457.52 177.751 2456.37 176.79 Q2455.23 175.83 2453.45 173.628 Q2451.66 171.426 2450.38 168.733 Q2447.21 162.198 2447.21 153.766 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2489.53 147.723 Q2489.53 149.035 2488.71 149.784 Q2487.89 150.51 2486.95 150.51 Q2486.06 150.51 2485.59 149.995 Q2485.12 149.48 2485.12 148.824 Q2485.12 147.934 2485.78 147.161 Q2486.43 146.388 2487.42 146.224 Q2486.46 145.615 2485.03 145.615 Q2484.09 145.615 2483.27 146.107 Q2482.48 146.599 2481.98 147.231 Q2481.52 147.863 2481.09 148.777 Q2480.7 149.667 2480.53 150.206 Q2480.39 150.721 2480.27 151.283 L2478.63 157.841 Q2477.84 160.957 2477.84 162.057 Q2477.84 163.416 2478.49 164.329 Q2479.15 165.22 2480.46 165.22 Q2480.98 165.22 2481.56 165.079 Q2482.15 164.915 2482.9 164.493 Q2483.67 164.048 2484.35 163.393 Q2485.05 162.713 2485.73 161.566 Q2486.41 160.418 2486.86 158.942 Q2487 158.427 2487.46 158.427 Q2488.05 158.427 2488.05 158.895 Q2488.05 159.294 2487.72 160.137 Q2487.42 160.957 2486.74 162.034 Q2486.08 163.088 2485.22 164.048 Q2484.35 164.985 2483.06 165.641 Q2481.77 166.297 2480.37 166.297 Q2478.35 166.297 2477.02 165.22 Q2475.68 164.142 2475.19 162.643 Q2475.07 162.854 2474.91 163.135 Q2474.75 163.416 2474.25 164.048 Q2473.79 164.657 2473.25 165.126 Q2472.71 165.571 2471.87 165.922 Q2471.05 166.297 2470.16 166.297 Q2469.03 166.297 2468.02 165.969 Q2467.04 165.641 2466.34 164.892 Q2465.64 164.142 2465.64 163.112 Q2465.64 161.964 2466.41 161.167 Q2467.2 160.348 2468.28 160.348 Q2468.96 160.348 2469.5 160.746 Q2470.06 161.144 2470.06 162.011 Q2470.06 162.971 2469.41 163.697 Q2468.75 164.423 2467.81 164.611 Q2468.77 165.22 2470.2 165.22 Q2471.75 165.22 2472.97 163.861 Q2474.18 162.503 2474.77 160.231 Q2476.22 154.773 2476.78 152.337 Q2477.35 149.878 2477.35 148.824 Q2477.35 147.84 2477.09 147.161 Q2476.83 146.482 2476.39 146.177 Q2475.96 145.849 2475.57 145.732 Q2475.19 145.615 2474.77 145.615 Q2474.07 145.615 2473.27 145.896 Q2472.5 146.177 2471.56 146.833 Q2470.65 147.465 2469.78 148.777 Q2468.91 150.089 2468.33 151.892 Q2468.21 152.431 2467.7 152.431 Q2467.13 152.407 2467.13 151.939 Q2467.13 151.541 2467.44 150.721 Q2467.77 149.878 2468.42 148.824 Q2469.1 147.77 2469.97 146.833 Q2470.86 145.873 2472.15 145.217 Q2473.46 144.561 2474.86 144.561 Q2475.5 144.561 2476.1 144.701 Q2476.74 144.819 2477.49 145.17 Q2478.26 145.521 2478.94 146.294 Q2479.62 147.067 2480.04 148.191 Q2480.32 147.653 2480.7 147.137 Q2481.09 146.622 2481.7 145.99 Q2482.34 145.334 2483.2 144.959 Q2484.09 144.561 2485.08 144.561 Q2486.04 144.561 2486.97 144.819 Q2487.91 145.053 2488.71 145.826 Q2489.53 146.575 2489.53 147.723 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2509.61 167.408 Q2509.61 168.342 2509.04 168.9 Q2508.48 169.457 2507.78 169.457 Q2507.15 169.457 2506.83 169.096 Q2506.5 168.736 2506.5 168.277 Q2506.5 168.08 2506.58 167.834 Q2506.66 167.572 2506.84 167.26 Q2507.04 166.948 2507.45 166.719 Q2507.86 166.489 2508.42 166.457 Q2508.3 166.342 2508.27 166.325 Q2508.02 166.129 2507.56 166.063 Q2507.5 166.03 2507.27 166.03 Q2506.14 166.03 2504.99 166.867 Q2503.86 167.686 2502.47 169.244 Q2500.71 171.064 2499.58 171.736 Q2504.55 172.392 2504.55 175.261 Q2504.55 175.737 2504.42 176.31 Q2504.15 177.393 2504.15 178.18 Q2504.15 179.754 2505.22 179.754 Q2506.25 179.754 2506.91 178.704 Q2507.58 177.655 2508.14 175.605 Q2508.22 175.228 2508.3 175.114 Q2508.38 174.999 2508.61 174.999 Q2509.02 174.999 2509.02 175.327 Q2508.65 177.245 2507.81 178.721 Q2506.74 180.508 2505.15 180.508 Q2503.83 180.508 2502.94 179.59 Q2502.07 178.655 2502.07 177.179 Q2502.07 176.819 2502.2 175.999 Q2502.3 175.671 2502.3 175.294 Q2502.3 174.523 2501.88 173.949 Q2501.45 173.359 2500.76 173.064 Q2500.07 172.769 2499.5 172.638 Q2498.94 172.49 2498.4 172.441 Q2496.76 179.376 2496.53 179.803 Q2496.38 180.098 2496.05 180.295 Q2495.73 180.508 2495.38 180.508 Q2495.05 180.508 2494.73 180.278 Q2494.42 180.065 2494.42 179.557 Q2494.42 179.294 2494.55 178.819 L2499.42 159.472 L2499.51 158.816 Q2499.51 158.619 2499.43 158.521 Q2499.37 158.406 2498.97 158.324 Q2498.6 158.242 2497.84 158.242 Q2497.53 158.242 2497.38 158.226 Q2497.25 158.21 2497.14 158.128 Q2497.02 158.029 2497.02 157.832 Q2497.02 157.554 2497.14 157.406 Q2497.27 157.242 2497.37 157.209 Q2497.46 157.177 2497.66 157.16 Q2497.94 157.144 2498.87 157.062 Q2499.81 156.964 2500.61 156.898 Q2501.42 156.832 2501.76 156.832 Q2501.96 156.832 2502.06 156.931 Q2502.17 157.013 2502.19 157.111 L2502.2 157.193 L2498.71 171.359 Q2500.15 170.785 2502.43 168.244 Q2505.07 165.293 2507.33 165.293 Q2508.4 165.293 2509.01 165.948 Q2509.61 166.588 2509.61 167.408 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2514.59 177.282 Q2514.59 177.048 2515.2 176.462 Q2522.93 168.592 2522.93 153.766 Q2522.93 138.893 2515.5 131.374 Q2514.59 130.507 2514.59 130.25 Q2514.59 129.781 2515.06 129.781 Q2515.39 129.781 2516.53 130.742 Q2517.71 131.702 2519.46 133.904 Q2521.24 136.105 2522.55 138.799 Q2525.72 145.334 2525.72 153.766 Q2525.72 161.87 2522.69 168.405 Q2521.41 171.145 2519.6 173.441 Q2517.8 175.736 2516.6 176.743 Q2515.41 177.751 2515.06 177.751 Q2514.59 177.751 2514.59 177.282 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path></svg>
</div>
</div>
</section>
<section id="sec-julia-methods" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="sec-julia-methods"><span class="header-section-number">2.4.4</span> Methods</h3>
<p>Julia allows a single function name to provide a common interface to different implementations (methods) based on the number and type of the arguments. The process of looking up the appropriate method from the invocation can take into account the types of more than one of the arguments (multiple dispatch). For example, consider the definitions</p>
<div id="d040f698" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">myrotate</span>(z <span class="op">::</span><span class="dt"> Complex</span>, θ) <span class="op">=</span> <span class="fu">exp</span>(<span class="fl">1im</span><span class="op">*</span>θ)<span class="op">*</span>z</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">myrotate</span>(xy <span class="op">::</span><span class="dt"> Vector</span>, θ) <span class="op">=</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> c <span class="op">=</span> <span class="fu">cos</span>(θ), s <span class="op">=</span> <span class="fu">sin</span>(θ), x <span class="op">=</span> xy[<span class="fl">1</span>], y <span class="op">=</span> xy[<span class="fl">2</span>]</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>        [c<span class="op">*</span>x<span class="op">-</span>s<span class="op">*</span>y; s<span class="op">*</span>x<span class="op">+</span>c<span class="op">*</span>y]</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both versions of <code>myrotate</code> correspond to a rotation of a plane, but we have different implementations depending on whether the first argument is a complex number or a vector.</p>
<div id="98b4f220" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="fu">myrotate</span>(<span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.0im</span>, <span class="cn">π</span><span class="op">/</span><span class="fl">4</span>))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="fu">myrotate</span>([<span class="fl">1.0</span>; <span class="fl">0.0</span>], <span class="cn">π</span><span class="op">/</span><span class="fl">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7071067811865476 + 0.7071067811865475im
[0.7071067811865476, 0.7071067811865475]</code></pre>
</div>
</div>
<p>Methods are also very useful for defining structurally recursive functions to process data structures. For example, consider “flattening” a structure of nested tuples into a vector:</p>
<div id="5ba8c610" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">flatten_tuple</span>(t)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(x <span class="op">::</span><span class="dt"> Tuple</span>) <span class="op">=</span> <span class="fu">process</span>.(x)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(x) <span class="op">=</span> <span class="fu">push!</span>(result, x)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(t)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    result</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> ((<span class="fl">1</span>,<span class="fl">2</span>), (<span class="fl">3</span>,(<span class="fl">4</span>,<span class="fl">5</span>)), <span class="fl">6</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">flatten_tuple</span>(t)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>6-element Vector{Any}:
 1
 2
 3
 4
 5
 6</code></pre>
</div>
</div>
<p>We will have more to say about Julia’s type system in <a href="#sec-julia-types" class="quarto-xref"><span>Section 2.5</span></a>.</p>
</section>
<section id="sec-julia-op-overloading" class="level3" data-number="2.4.5">
<h3 data-number="2.4.5" class="anchored" data-anchor-id="sec-julia-op-overloading"><span class="header-section-number">2.4.5</span> Operator overloading</h3>
<p>As mentioned previously, operators in Julia are just a special type of function. We can add methods to these functions in order to implement operators acting on new types. For example, consider a new type <code>Polynomial</code> representing polynomials expressed in the monomial basis (we will return to this in <a href="#sec-julia-types" class="quarto-xref"><span>Section 2.5</span></a>):</p>
<div id="c3f03375" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Polynomial</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    coeffs <span class="op">::</span><span class="dt"> Vector{Float64}</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We would like to be able to add, subtract, and multiply polynomials. For example, to add implementation of the <code>+</code> and <code>*</code> operators from <code>Base</code> that works with a <code>Polynomial</code>, we would write</p>
<div id="ddcaa41e" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(p <span class="op">::</span><span class="dt"> Polynomial</span>, q <span class="op">::</span><span class="dt"> Polynomial</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>      n <span class="op">=</span> <span class="fu">max</span>(<span class="fu">length</span>(p.coeffs), <span class="fu">length</span>(q.coeffs))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>      c <span class="op">=</span> <span class="fu">zeros</span>(n)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      c[<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(p.coeffs)] <span class="op">=</span> p.coeffs</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>      c[<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(q.coeffs)] <span class="op">+=</span> q.coeffs</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Polynomial</span>(c)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="bu">Base</span>.<span class="op">:</span><span class="fu">*</span>(p <span class="op">::</span><span class="dt"> Polynomial</span>, q <span class="op">::</span><span class="dt"> Polynomial</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>      n <span class="op">=</span> <span class="fu">length</span>(p.coeffs) <span class="op">+</span> <span class="fu">length</span>(q.coeffs) <span class="op">-</span> <span class="fl">1</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>      c <span class="op">=</span> <span class="fu">zeros</span>(n)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i, <span class="cn">pi</span>) <span class="kw">in</span> <span class="fu">enumerate</span>(p.coeffs)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>            c[i<span class="op">:</span><span class="fu">length</span>(q.coeffs)<span class="op">+</span>i<span class="op">-</span><span class="fl">1</span>] <span class="op">+=</span> <span class="cn">pi</span><span class="op">*</span>q.coeffs</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">end</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Polynomial</span>(c)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we would like to treat constants as a type of polynomial, we need to add a conversion routine and some additional methods for the <code>+</code> and <code>*</code> functions.</p>
<div id="771faf02" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">convert</span>(<span class="op">::</span><span class="dt">Type{Polynomial}</span>, c <span class="op">::</span><span class="dt"> Number</span>) <span class="op">=</span> <span class="fu">Polynomial</span>([c])</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(p <span class="op">::</span><span class="dt"> Polynomial</span>, q) <span class="op">=</span> p <span class="op">+</span> <span class="fu">convert</span>(Polynomial, q)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(p, q <span class="op">::</span><span class="dt"> Polynomial</span>) <span class="op">=</span> <span class="fu">convert</span>(Polynomial, p) <span class="op">+</span> q</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">*</span>(p <span class="op">::</span><span class="dt"> Polynomial</span>, q) <span class="op">=</span> p <span class="op">*</span> <span class="fu">convert</span>(Polynomial, q)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">*</span>(p, q <span class="op">::</span><span class="dt"> Polynomial</span>) <span class="op">=</span> <span class="fu">convert</span>(Polynomial, p) <span class="op">*</span> q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We might also want to be able to evaluate a polynomial, since it represents a function:</p>
<div id="a08df2d3" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> (p <span class="op">::</span><span class="dt"> Polynomial</span>)(x)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    px <span class="op">=</span> <span class="fl">0</span><span class="op">*</span>x</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fu">reverse</span>(p.coeffs)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        px <span class="op">=</span> px<span class="op">*</span>x<span class="op">+</span>c</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    px</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With these definitions in place, we can write code like</p>
<div id="3a13877d" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">Polynomial</span>([<span class="fl">0</span>; <span class="fl">1</span>])  <span class="co"># x</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">x*</span>(<span class="fl">2</span><span class="op">*</span>x<span class="op">+</span><span class="fl">1</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">p</span>(<span class="fl">2</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>10.0</code></pre>
</div>
</div>
<p>The ambitious reader might also try writing subtraction, polynomial division and remainders.</p>
</section>
<section id="sec-julia-higher-order" class="level3" data-number="2.4.6">
<h3 data-number="2.4.6" class="anchored" data-anchor-id="sec-julia-higher-order"><span class="header-section-number">2.4.6</span> Higher-order functions</h3>
<p>A <em>higher-order</em> function is a function that takes another function as an argument. Higher-order functions like <code>map</code>, <code>filter</code>, and <code>reduce</code> are the bread-and-butter of functional programming languages, and Julia supports these as well:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(x<span class="op">-&gt;</span>x<span class="op">+</span><span class="fl">1</span>, [<span class="fl">1</span>; <span class="fl">2</span>; <span class="fl">3</span>])           <span class="co"># Yields [2; 3; 4]</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(x<span class="op">-&gt;</span>x <span class="op">&gt;</span> <span class="fl">0</span>, [<span class="fl">1</span>; <span class="op">-</span><span class="fl">1</span>; <span class="fl">2</span>; <span class="fl">3</span>])  <span class="co"># Yields [1; 2; 3]</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="op">+</span>, [<span class="fl">1</span>; <span class="fl">2</span>; <span class="fl">3</span>])             <span class="co"># Yields 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Higher-order functions are quite common in numerical methods, as many of the operations that we want to perform are naturally expressed in terms of operations on functions (computing integrals and derivatives, optimizing, finding zeros). Indeed, we already saw a simple example of a higher-order function with the <code>naive_newton</code> example in <a href="#sec-julia-closures" class="quarto-xref"><span>Section 2.4.3</span></a>.</p>
</section>
<section id="do-syntax" class="level3" data-number="2.4.7">
<h3 data-number="2.4.7" class="anchored" data-anchor-id="do-syntax"><span class="header-section-number">2.4.7</span> do syntax</h3>
<p>A common pattern in higher-order functions is to have a function that takes one function argument and potentially a few other operations. When the argument function is small, it is convenient to use the <code>-&gt;</code> operation to define a short anonymous function, as we did in <a href="#sec-julia-higher-order" class="quarto-xref"><span>Section 2.4.6</span></a>. But sometimes when the argument function is not small, it gets clunky to write it in place as an anonymous function. For example, suppose we wanted a verbose version of the <code>filter</code> example above, one that prints out a description of what is going on at each step. Using the notation we have written so far, we could write something like</p>
<div id="b6605fe9" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="kw">function</span>(x)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>           ispositive <span class="op">=</span> x <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>           action <span class="op">=</span> ispositive ? <span class="st">"Keep it"</span> <span class="op">:</span> <span class="st">"Toss it"</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">println</span>(<span class="st">"Testing x = </span><span class="sc">$</span>x<span class="st">: </span><span class="sc">$</span>action<span class="st">"</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>           ispositive</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span>, [<span class="fl">1</span>; <span class="op">-</span><span class="fl">1</span>; <span class="fl">2</span>; <span class="fl">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Testing x = 1: Keep it
Testing x = -1: Toss it
Testing x = 2: Keep it
Testing x = 3: Keep it</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>3-element Vector{Int64}:
 1
 2
 3</code></pre>
</div>
</div>
<p>Because this pattern occurs so often in Julia, however, there is a special syntax that makes it easier to write:</p>
<div id="1c1a96da" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>([<span class="fl">1</span>; <span class="op">-</span><span class="fl">1</span>; <span class="fl">2</span>; <span class="fl">3</span>]) <span class="cf">do</span> x</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    ispositive <span class="op">=</span> x <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    action <span class="op">=</span> ispositive ? <span class="st">"Keep it"</span> <span class="op">:</span> <span class="st">"Toss it"</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"Testing x = </span><span class="sc">$</span>x<span class="st">: </span><span class="sc">$</span>action<span class="st">"</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    ispositive</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Testing x = 1: Keep it
Testing x = -1: Toss it
Testing x = 2: Keep it
Testing x = 3: Keep it</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>3-element Vector{Int64}:
 1
 2
 3</code></pre>
</div>
</div>
<p>Behind the scenes, Julia rewrites constructions of the form</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(fargs) <span class="cf">do</span> args</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    body</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>to</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="kw">function</span>(args) body <span class="kw">end</span>, fargs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Beyond being used with functions like <code>map</code> and <code>reduce</code>, the <code>do</code> syntax is often used in Julia for tasks like I/O that involve a required setup and teardown phase. For example, writing to a file in Julia is often done using syntax like the following:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">open</span>(<span class="st">"foo.txt"</span>, <span class="st">"w"</span>) <span class="cf">do</span> f</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(f, <span class="st">"Hello, world"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The version of the <code>open</code> method that takes a function argument in the terse syntax will call the function with the file handle, then close the file afterward.</p>
</section>
<section id="composition-and-pipes" class="level3" data-number="2.4.8">
<h3 data-number="2.4.8" class="anchored" data-anchor-id="composition-and-pipes"><span class="header-section-number">2.4.8</span> Composition and pipes</h3>
<p>In addition to nested calls (e.g.&nbsp;<code>f(g(x))</code>), Julia supports two special syntax constructs for function composition:</p>
<ul>
<li>The composition operator (<code>∘</code>) acts like composition in mathematics.</li>
<li>The pipeline operator (<code>|&gt;</code>) chains together inputs and outputs like the pipe symbol in a Unix shell command or pipes in R.</li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqr</span>(x) <span class="op">=</span> x<span class="op">.^</span><span class="fl">2</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">norm2a</span>(v) <span class="op">=</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="fu">sqr</span>(v)))</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>norm2b <span class="op">=</span> sqrt <span class="op">∘</span> sum <span class="op">∘</span> sqr</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">norm2c</span>(v) <span class="op">=</span> v <span class="op">|&gt;</span> sqr <span class="op">|&gt;</span> sum <span class="op">|&gt;</span> sqrt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generators-and-comprehensions" class="level3" data-number="2.4.9">
<h3 data-number="2.4.9" class="anchored" data-anchor-id="generators-and-comprehensions"><span class="header-section-number">2.4.9</span> Generators and comprehensions</h3>
<p><em>Generators</em> and <em>comprehensions</em> are a final type of specialized use of anonymous functions. A generator expression has the form <code>expr for var in collection</code>, with the option of additional comma-separated <code>var in collection</code> expressions. The expression evaluates to an iterable collection that is lazily evaluated. For example, consider the generator expression</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> ((i,j) <span class="cf">for</span> i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, j<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can loop over the generator the same as we would over any other collection; with each iteration, the expression <code>(i,j)</code> is evaluated with a different binding of <code>i</code> and <code>j</code> from the iteration space, visited in column-major order (early indices change fastest). For example, consider the output of the following code fragment:</p>
<div id="2eccc230" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> ((i,j) <span class="cf">for</span> i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, j<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> g</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">println</span>(v)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1, 1)
(2, 1)
(1, 2)
(2, 2)</code></pre>
</div>
</div>
<p>Iterable expressions can be used in many places where Julia would accept a list or vector. For example:</p>
<div id="32c12615" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(i<span class="op">^</span><span class="fl">2</span> <span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>385</code></pre>
</div>
</div>
<p>An <em>array comprehension</em> is similar to a generator, but with surrounding square brackets. Rather than producing a lazily-evaluated collection, it produces a concrete array of results. For example, if <span class="math inline">\(k(x,y)\)</span> is a bivariate function of interest, we can use a generator to concisely produce a matrix of function samples over a regular grid:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>xgrid <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>, length<span class="op">=</span><span class="fl">20</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>kxx <span class="op">=</span> [<span class="fu">k</span>(x,y) for x <span class="kw">in</span> xgrid, y <span class="kw">in</span> xgrid]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="sec-julia-types" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="sec-julia-types"><span class="header-section-number">2.5</span> Types</h2>
<p>At a certain level, computers only manipulate sequences of bits. But programmers usually work at a more abstract level, where those bit sequences are interpreted as different <em>types</em> of values: these 64 bits represent an integer, those 64 bits represent a floating point number, that other set of 64 bits represents the string <code>"program"</code> (with a null terminator). One of the classic distinctions drawn among programming languages is how types are treated. In <em>statically-typed</em> languages like C++ and Fortran, every variable and expression is associated with a particular type that can be determined at compile time<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. In <em>dynamically-typed</em> languages like MATLAB, Python, and R, values have types but variables are not restricted in the types of values to which they may refer. But, of course, things are not so simple — C++ is mostly statically typed, but run-time polymorphism allows some elements of dynamic typing; while modern Python is mostly dynamically typed, but allows optional <em>type annotations</em>.</p>
<p>Julia is a dynamically-typed language, in which variables are just names that can be bound to values of different types. At the same time, Julia has a rich type system with optional type declarations using the <code>::</code> syntax as described in <a href="#sec-julia-var-types" class="quarto-xref"><span>Section 2.2.1.2</span></a>. These type declarations serve three purposes:</p>
<ul>
<li><p><em>Correctness</em>: Sometimes an operation only makes sense with certain types of inputs, and declaring that explicitly makes it possible for the system to provide an early error rather than an error at runtime.</p></li>
<li><p><em>Expressivity</em>: Declaring the types of arguments to functions allows the same function name to dispatch to multiple methods, as discussed in <a href="#sec-julia-methods" class="quarto-xref"><span>Section 2.4.4</span></a>.</p></li>
<li><p><em>Performance</em>: When the Julia system can infer types in a function call, the just-in-time compiler can create faster specialized versions of the code, much like what we would find in C or Fortran.</p></li>
</ul>
<p>While type declarations is often helpful, Julia also benefits from not requiring them. As an example, consider the <code>gcd</code> function from <a href="#sec-julia-loops" class="quarto-xref"><span>Section 2.3.2</span></a>. We might argue that it is appropriate to restrict the arguments to be <code>Integer</code> types, i.e.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gcd</span>(a <span class="op">::</span><span class="dt"> Integer</span>, b <span class="op">::</span><span class="dt"> Integer</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> b <span class="op">!=</span> <span class="fl">0</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> b, a<span class="op">%</span>b</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    a</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, the Euclidean algorithm also makes sense in more general <a href="https://en.wikipedia.org/wiki/Euclidean_domain">Euclidean domains</a>, such as polynomials. So we might extend the operations on the <code>Polynomial</code> type from <a href="#sec-julia-op-overloading" class="quarto-xref"><span>Section 2.4.5</span></a> so that comparisons with zero and the remainder operator are both allowed. With this extension, the original <code>gcd</code> function (without the <code>:: Integer</code> annotations) would produce the correct result.</p>
<section id="type-hierarchy" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="type-hierarchy"><span class="header-section-number">2.5.1</span> Type hierarchy</h3>
<p>Julia types form a tree-shaped hierarchy, where each abstract type may have multiple <em>subtypes</em>. For example, <code>Integer</code> is a subtype of <code>Number</code>, and concrete integer types like <code>Int64</code> are subtypes of <code>Integer</code>. The syntax <code>&lt;:</code> is used to denote a subtype relation; for example, we would write <code>Integer &lt;: Number</code> to test that <code>Integer</code> is indeed a subtype of <code>Number</code>. At the root of the type hierarchy is the type <code>Any</code>.</p>
<p>Only <em>abstract</em> types may serve as supertypes in Julia. Concrete types, whether primitive types (like <code>Logical</code>, <code>UInt16</code>, or <code>Float64</code>), or various compound types, are always leaves of the hierarchy.</p>
</section>
<section id="numeric-types" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="numeric-types"><span class="header-section-number">2.5.2</span> Numeric types</h3>
<p>The <em>primitive</em> concrete numeric types in Julia are</p>
<ul>
<li><p>Floating point numbers <code>Float16</code>, <code>Float32</code>, and <code>Float64</code>. These are all subtypes of <code>AbstractFloat</code>. The 32-bit and 64-bit formats are supported in hardware, but operations with the 16-bit format are software only. We will have much more to say about floating point in <a href="../01-Fund1d/02-Arithmetic.html" class="quarto-xref"><span>Chapter 9</span></a>.</p></li>
<li><p>Signed integer types <code>Int8</code>, <code>Int16</code>, <code>Int32</code>, <code>Int64</code>, and <code>Int128</code>. These are all subtypes of <code>Signed</code>, which is a subtype of <code>Integer</code>. The type <code>Int</code> is an alias for <code>Int64</code> or <code>Int32</code>, depending on whether Julia is being run on a 64-bit or a 32-bit system.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p></li>
<li><p>Unsigned integer types <code>UInt8</code>, <code>UInt16</code>, <code>UInt32</code>, <code>UInt64</code>, and <code>UInt128</code>. These are all subtypes of <code>Unsigned</code>, which is a subtype of <code>Integer</code>.</p></li>
</ul>
<p>Technically, type <code>Logical</code> is also a subtype of type <code>Integer</code>, and it can be used in arithmetic expressions like an integer – for example, <code>true + true</code> evaluates to <code>2</code>, while <code>1.0 * false</code> evaluates to <code>0.0</code>. However, we do not recommend using logical variables in this way.</p>
<p>In addition to the primitive types, Julia supports parameterized types for rational and complex numbers. For example, <code>3 // 4</code> produces a representation of <span class="math inline">\(3/4\)</span> of type <code>Rational{Int64}</code>, while <code>1.0 + 1.0im</code> produces a representation of <span class="math inline">\(1+1i\)</span> of type <code>Complex{Float64}</code>.</p>
<p>Julia also supports arbitrary-precision <code>BigInt</code> and <code>BigFloat</code> types, though we will rarely make use of these.</p>
</section>
<section id="sec-julia-strings" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="sec-julia-strings"><span class="header-section-number">2.5.3</span> Strings and symbols</h3>
<p>Strings in Julia inherit from the <code>AbstractString</code> type, and are logically sequences of Unicode characters<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Unicode characters (or “code points”) in turn inherit from the <code>AbstractChar</code> type, and are associated with 32-bit unsigned integers. The character <code>A</code>, for example, corresponds to code point U+0041; this is character 65 in decimal, but Unicode codepoints are typically written in hexadecimal. More generally, code points U+0000 through U+007F correspond to the classic ASCII character set, which includes Latin characters and punctuation used in standard English.</p>
<p>The default character type <code>Char</code> in Julia takes 32 bits in memory. The default <code>String</code> type is <em>not</em> an array of 32-bit <code>Char</code> entities; instead, Julia uses UTF-8 strings, which use a variable-length encoding. Unicode codepoint numbers corresponding to ASCII are encoded with one byte per character, and other characters may take more than one byte to represent. Hence, the <code>length</code> of a string (in characters) and the <code>sizeof</code> a string (in bytes) mean different things in Julia. These are also different complexity: computing the length (in codeunits) in a UTF-8 string requires that we scan the string from start to end. To avoid the time cost of a scan, <em>indexing</em> into a standard string is done by bytes. For example, in the string <code>s = "sπot"</code>, we can safely refer to <code>s[1]</code> (s), <code>s[2]</code> (π), <code>s[4]</code> (o), and <code>s[5]</code> (t); but accessing <code>s[3]</code> will cause a runtime exception.</p>
<p>Symbols inherit from type <code>Symbol</code>. They are encoded as “interned” UTF-8 strings, which means that the string is stored in a hash table, and the data passed around the Julia environment is the location in that hash table.</p>
</section>
<section id="tuples" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="tuples"><span class="header-section-number">2.5.4</span> Tuples</h3>
<p>The type of a tuple is a Cartesian product of the tuple elements. In Julia, this is represented as <code>Tuple</code>, a parameterized type whose parameters are the component types. For example, the type of <code>(1.0, 2)</code> is <code>Tuple{Float64,Int64}</code>. Named tuples are similar; the type of <code>(x=1.0, y=2)</code> is <code>@NamedTuple{x :: Float64, y :: Int64}</code>.</p>
</section>
<section id="structs-and-parameterization" class="level3" data-number="2.5.5">
<h3 data-number="2.5.5" class="anchored" data-anchor-id="structs-and-parameterization"><span class="header-section-number">2.5.5</span> Structs and parameterization</h3>
<p>We declare a structure type (sometimes called a record type) with the <code>struct</code> keyword; for example, we might define a type for rational numbers as</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Version 0</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MyRational <span class="op">&lt;:</span><span class="dt"> Number</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    p</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    q</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then <code>MyRational(1,2)</code> will give us an instance of <code>MyRational</code> with <code>p</code> set to 1 and <code>q</code> set to 2. However, this definition also allows us to legitimately write <code>MyRational("bad", "idea")</code>, and we probably do not want to allow a ratio of two strings. A second attempt at a definition might be</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Version 1</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MyRational <span class="op">&lt;:</span><span class="dt"> Number</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    p <span class="op">::</span><span class="dt"> Integer</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    q <span class="op">::</span><span class="dt"> Integer</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With this definition, we are restricted to integer values for <code>p</code> and <code>q</code>. However, we may still be unhappy with this if we read about Julia performance, and see the advice to make fields be concrete types to produce efficient code (<code>Integer</code> is an abstract type). This brings us to our third attempt, which involves making <code>MyRational</code> a <em>parametric</em> type:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MyRational{T<span class="op">&lt;:</span><span class="dt">Integer</span>} <span class="op">&lt;:</span><span class="dt"> Number</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">::</span><span class="dt"> T</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    q <span class="op">::</span><span class="dt"> T</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Writing <code>{T&lt;:Integer}</code> after the structure name says that we want to have a type parameter <code>T</code> which is a subtype of <code>Integer</code>. With this definition, the constructor <code>MyRational(1,2)</code> will give us an instance of type <code>MyRational{Int64}</code> (assuming a 64-bit machine).</p>
<p>We may decide that we would like to make <code>p</code> and <code>q</code> have reduced form, and disallow a zero denominator. To do this, we would create a new <em>inner constructor</em> function:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MyRational{T<span class="op">&lt;:</span><span class="dt">Integer</span>} <span class="op">&lt;:</span><span class="dt"> Number</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">::</span><span class="dt"> T</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    q <span class="op">::</span><span class="dt"> T</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MyRational</span>(p <span class="op">::</span><span class="dt"> Integer</span>, q <span class="op">::</span><span class="dt"> Integer</span>) <span class="op">=</span> </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> q <span class="op">==</span> <span class="fu">zero</span>(q)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">error</span>(<span class="st">"Divide by zero"</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>            p, q <span class="op">=</span> <span class="fu">promote</span>(p, q)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>            r <span class="op">=</span> <span class="fu">gcd</span>(p, q)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">new</span><span class="dt">{typeof(p)}</span>(p<span class="op">÷</span>r, q<span class="op">÷</span>r)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are several things to unpack here:</p>
<ul>
<li><p>The <code>MyRational</code> takes two abstract <code>Integers</code>. These could be different types of integers! In order to gracefully deal with this, we <em>promote</em> the arguments to a common type with the <code>promote</code> command (see <a href="#sec-julia-convert-promote" class="quarto-xref"><span>Section 2.5.11</span></a>)</p></li>
<li><p>Inside the <code>MyRational</code> constructor, we cannot just call another constructor called <code>MyRational</code>. Instead, we call <code>new</code> to create the object. This is only used inside of inner constructors.</p></li>
<li><p>The <code>new</code> call needs a type parameter, which we get from the type of <code>p</code>.</p></li>
</ul>
<p>In addition to inner constructors, we can also define an <em>outer constructor</em>, so named because the definition is outside the <code>struct</code> statement. For example, we might want to define a constructor that takes just one argument (with the second being an implicit 1):</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MyRational</span>(p <span class="op">::</span><span class="dt"> Integer</span>) <span class="op">=</span> <span class="fu">MyRational</span>(p, <span class="fu">one</span>(p))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As described earlier, we might also decide that we wanted to overload the operators. Note that this does not require any special magic with the type parameters to <code>MyRational</code>:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a <span class="op">::</span><span class="dt"> MyRational</span>, b <span class="op">::</span><span class="dt"> MyRational</span>) <span class="op">=</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MyRational</span>(a.p<span class="op">*</span>b.q <span class="op">+</span> a.q<span class="op">*</span>b.p, a.q<span class="op">*</span>b.q)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">-</span>(a <span class="op">::</span><span class="dt"> MyRational</span>, b <span class="op">::</span><span class="dt"> MyRational</span>) <span class="op">=</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MyRational</span>(a.p<span class="op">*</span>b.q <span class="op">-</span> a.q<span class="op">*</span>b.p, a.q<span class="op">*</span>b.q)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">*</span>(a <span class="op">::</span><span class="dt"> MyRational</span>, b <span class="op">::</span><span class="dt"> MyRational</span>) <span class="op">=</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MyRational</span>(a.p<span class="op">*</span>b.p, a.q<span class="op">*</span>b.q)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:/</span>(a <span class="op">::</span><span class="dt"> MyRational</span>, b <span class="op">::</span><span class="dt"> MyRational</span>) <span class="op">=</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MyRational</span>(a.p<span class="op">*</span>b.q, a.q<span class="op">*</span>b.p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What if we want to get the type associated with <code>p</code> and <code>q</code>? We can, of course, use <code>typeof(p)</code> to do this, but we can also write a method to extract the type. Unlike the overloaded operators, this method <em>does</em> explicitly refer to the type parameter, and so we need some additional syntax:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inttype</span>(<span class="op">::</span><span class="dt"> MyRational{T}</span>) <span class="kw">where</span> {T} <span class="op">=</span> T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Unpacking this construction, we have</p>
<ul>
<li><p>An anonymous argument of type <code>MyRational{T}</code>. We do not need to give the argument a name, because we do not care about the value of the variable; we only care about its type.</p></li>
<li><p>The <code>where {T}</code> clause to specify that this method definition is parameterized by the type <code>T</code>.</p></li>
</ul>
</section>
<section id="mutable-structs" class="level3" data-number="2.5.6">
<h3 data-number="2.5.6" class="anchored" data-anchor-id="mutable-structs"><span class="header-section-number">2.5.6</span> Mutable structs</h3>
<p>By default, the entries of a struct are <em>immutable</em>. Using the example from the previous section, once we have created a <code>MyRational</code> with a given <code>p</code> and <code>q</code>, we cannot change those values. Note that if any field of a structure is a writeable container (like an array), we <em>can</em> write into that container; the container is immutable, but its contents are not. Still, sometimes we would genuinely like to be able to update a structure, and for this we have <em>mutable</em> structures, which are declared with the <code>mutable</code> keyword. For example, consider the following counter struct:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mutable struct</span> FooCounter</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">::</span><span class="dt"> Int</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">FooCounter</span>() <span class="op">=</span> <span class="fu">new</span>(<span class="fl">0</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we can write an increment operator that updates this structure (using an exclamation mark in the name, as is the convention for functions that change their inputs):</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">increment!</span>(f <span class="op">::</span><span class="dt"> FooCounter</span>) <span class="op">=</span> (f.p <span class="op">+=</span> <span class="fl">1</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>foo <span class="op">=</span> <span class="fu">FooCounter</span>()        <span class="co"># foo.p initialized to 0</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="fu">increment!</span>(foo))  <span class="co"># Prints 1</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="fu">increment!</span>(foo))  <span class="co"># Prints 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="array-types" class="level3" data-number="2.5.7">
<h3 data-number="2.5.7" class="anchored" data-anchor-id="array-types"><span class="header-section-number">2.5.7</span> Array types</h3>
<p>An <code>Array{T,d}</code> is a <span class="math inline">\(d\)</span>-index array of type <code>T</code>. The type aliases <code>Vector{T}</code> and <code>Matrix{T}</code> correspond to arrays with <code>d</code> set to 1 and 2, respectively. It is possible to make <code>T</code> an abstract type, but it is generally much more efficient to make <code>T</code> a concrete type.</p>
<p>In addition to arrays, there are several constructs that are subtypes of the <code>AbstractArray</code> interface. These includes:</p>
<ul>
<li><p><code>Range</code>: An abstraction for a regularly-spaced range, which can be constructed by the colon operator (e.g.&nbsp;<code>1:3</code>) or with the <code>range</code> command.</p></li>
<li><p><code>Adjoint</code>: (Conjugate) transpose of a matrix.</p></li>
<li><p><code>BitArray</code>: A compact storage format for an array of logical values.</p></li>
<li><p><code>SparseMatrixCSC</code>: A sparse matrix format.</p></li>
<li><p><code>SubArray</code>: A submatrix of an existing matrix, which can be constructied using the <code>view</code> macros.</p></li>
<li><p><code>StaticArray</code>: An fast type for small arrays whose dimensions are part of the type.</p></li>
</ul>
<p>These constructs can all be indexed, sliced, iterated over, and otherwise treated much like ordinary arrays (though not all are writeable).</p>
</section>
<section id="other-collections" class="level3" data-number="2.5.8">
<h3 data-number="2.5.8" class="anchored" data-anchor-id="other-collections"><span class="header-section-number">2.5.8</span> Other collections</h3>
<p>In addition to tuples and array-like collections, Julia supports dictionary and set types. A dictionary contains key-value pairs, written as <code>key =&gt; value</code> in Julia; the <code>=&gt;</code> operator constructs a <code>Pair</code> object. The structure supports addition and deletion of pairs, testing for keys, iteration, and lookup (either with <code>get</code>, which supports default values, or with <code>dict[key]</code>, which does not). There are a few variants, the most frequently used of which is the ordinary dictionary (<code>Dict</code>).</p>
<p>Julia also supports a <code>Set</code> type, which supports addition and removal, testing for inclusion or subset relations, and operations like union, intersection, and set differences.</p>
</section>
<section id="unions-nothing-and-missing" class="level3" data-number="2.5.9">
<h3 data-number="2.5.9" class="anchored" data-anchor-id="unions-nothing-and-missing"><span class="header-section-number">2.5.9</span> Unions, Nothing, and Missing</h3>
<p>Julia allows <code>Union</code> types whose values may be one of a selection of types. Two specific examples have to do with data that may be “null” or missing<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. In Julia, the type <code>Nothing</code> (with instance <code>nothing</code>) is used the way that programmers use “null” in some other languages, while the type <code>Missing</code> (with instance <code>missing</code>) is used to indicate missing data. These types are most often used in the context of <code>Union{T, Nothing}</code> or <code>Union{T, Missing}</code> types. For example, values of type <code>Union{T, Missing}</code> can either be something of type T or the value <code>missing</code>.</p>
</section>
<section id="types-of-types-and-value-types" class="level3" data-number="2.5.10">
<h3 data-number="2.5.10" class="anchored" data-anchor-id="types-of-types-and-value-types"><span class="header-section-number">2.5.10</span> Types of types and value types</h3>
<p>Types are themselves things that can be represented and manipulated in Julia. Each type has type <code>DataType</code>, which is a subtype of the parametric abstract type <code>Type{T}</code>. In general, a type <code>T</code> (and no other type) is an instance of <code>Type{T}</code>. This can be useful for certain special types of method dispatch situations. Similarly, <em>value types</em> (<code>Val{T}</code>) are parameterized types that take a value as a parameter, and can be used for specialized method dispatch or for helping the compiler with performant code.</p>
</section>
<section id="sec-julia-convert-promote" class="level3" data-number="2.5.11">
<h3 data-number="2.5.11" class="anchored" data-anchor-id="sec-julia-convert-promote"><span class="header-section-number">2.5.11</span> Type conversions and promotions</h3>
<p>The <code>convert</code> function in Julia is used to convert values of one type to another type (when possible). The system calls <code>convert</code> automatically when assigning a value of one type to a variable or field of another type. The first argument is the target type, and the second is the value to be converted. Defining new methods for <code>convert</code> is a good use of the <code>Type</code> type; for example, we might define a conversion from an <code>Integer</code> to the <code>MyRational</code> type defined earlier as:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">convert</span>(<span class="op">::</span><span class="dt">Type{MyRational}</span>, p <span class="op">::</span><span class="dt"> Integer</span>) <span class="op">=</span> <span class="fu">MyRational</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A more elaborate example might involve converting <code>MyRational</code> values with different integer parameter types:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">convert</span>(<span class="op">::</span><span class="dt">Type{MyRational{T}}</span>, r <span class="op">::</span><span class="dt"> MyRational</span>) <span class="kw">where</span> {T} <span class="op">=</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MyRational</span>(<span class="fu">T</span>(r.p), <span class="fu">T</span>(r.q))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>promote</code> function in Julia takes a list of values and converts them both to a compatible greatest type. We typically would not write new methods for <code>promote</code>; instead, we write new methods for <code>promote_rule</code>. Again using <code>MyRational</code> as an example, we might have</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">promote_rule</span>(<span class="op">::</span><span class="dt">Type{MyRational{T}}</span>, <span class="op">::</span><span class="dt">Type{S}</span>) <span class="kw">where</span> {T<span class="op">&lt;:</span><span class="dt">Integer</span>,S<span class="op">&lt;:</span><span class="dt">Integer</span>} <span class="op">=</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    MyRational{<span class="fu">promote_type</span>(T,S)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="sec-julia-exceptions" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="sec-julia-exceptions"><span class="header-section-number">2.6</span> Exception handling</h2>
<p>Julia has throw/catch system for handling exceptional conditions, similar to many other modern languages (Python, MATLAB, R, Java, C++). Information about exceptions is encoded in via a struct that is a subtype of <code>Exception</code>, which we <code>throw</code> when the error is detected:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="st">"""    imlog(x)</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="st">Compute the imaginary part of the principal branch</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="st">of the log of negative number x.</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="fu">imlog</span>(x) <span class="op">=</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    (x <span class="op">&gt;=</span> <span class="fu">zero</span>(x)) ? </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">throw</span>(<span class="fu">DomainError</span>(<span class="st">"Argument must be negative"</span>)) <span class="op">:</span> </span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(<span class="op">-</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>error</code> function throws an instance of an <code>ErrorException</code>.</p>
<p>Exceptions that are thrown at some point in a call chain can be <em>caught</em> by callers using a <code>try</code>/<code>catch</code> statement.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="st">"""    generous_log(x :: Number)</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="st">Computes the log of a number; if a domain error is</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="st">thrown for the log of a negative real number, tries</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="st">with a complex version of the number.</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="fu">generous_log</span>(x <span class="op">::</span><span class="dt"> Number</span>) <span class="op">=</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    try</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">log</span>(x)</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>    catch <span class="cn">e</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="cn">e</span> isa <span class="dt">DomainError</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">log</span>(<span class="fu">Complex</span>(x))</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">throw</span>(<span class="cn">e</span>)</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These statements may also have an optional <code>else</code> clause that is executed when the <code>try</code> statement succeeded without exceptions; and an optional <code>finally</code> clause that is executed when exiting the <code>try</code>/<code>catch</code>, independent of how the exit occurred.</p>
</section>
<section id="documentation" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="documentation"><span class="header-section-number">2.7</span> Documentation</h2>
<p>Functions, types, and modules can all have <em>documentation strings</em> just before them, which are referenced by the Julia help system. Documentation strings are formatted using Markdown. A fenced code block beginning with <code>jldoctest</code> can be used to produce a usage example that is suitable for automatic testing.</p>
</section>
<section id="sec-julia-linalg" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="sec-julia-linalg"><span class="header-section-number">2.8</span> Vectors, matrices, and linear algebra</h2>
<p>We have already discussed some of Julia’s array support. However, one of the attractive features of Julia is the support not only for arrays, but for numerical linear algebra computations. Many of these facilities are in the <code>LinearAlgebra</code> package, which we will almost always use throughout this book.</p>
<section id="building-matrices-and-vectors" class="level3" data-number="2.8.1">
<h3 data-number="2.8.1" class="anchored" data-anchor-id="building-matrices-and-vectors"><span class="header-section-number">2.8.1</span> Building matrices and vectors</h3>
<p>By default, we think of a one-dimensional array as a column vector, and a two-dimensional array as a matrix. We can do standard linear algebra operations like scaling (<code>2*A</code>), summing like types of objects (<code>v1+v2</code>), and matrix multiplication (<code>A*v</code>). The expression</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> v<span class="op">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>represents the adjoint of the vector <code>v</code> with respect to the standard inner product (i.e.&nbsp;the conjugate transpose). The tick operator also gives the (conjugate) transpose of a matrix. We note that the tick operator in Julia does not actually copy any storage; it just gives us a re-interpretation of the argument. This shows up, for example, if we write</p>
<div id="b2ab6d11" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> [<span class="fl">1</span>, <span class="fl">2</span>]  <span class="co"># v is a 2-element Vector{Int64} containing [1, 2]</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> v<span class="op">'</span>      <span class="co"># w is a 1-2 adjoint(::Vector{Int64}) with eltype Int64</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    v[<span class="fl">2</span>] <span class="op">=</span> <span class="fl">3</span>    <span class="co"># Now v contains [1, 3] and w is the adjoint [1, 3]'</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>3</code></pre>
</div>
</div>
<p>Julia gives us several standard matrix and vector construction functions.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> <span class="fu">zeros</span>(n)   <span class="co"># Length n vector of zeros</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> <span class="fu">zeros</span>(n,n) <span class="co"># n-by-n matrix of zeros</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fu">rand</span>(n)    <span class="co"># Length n random vector of U[0,1] entries (from Random)</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="cn">e</span> <span class="op">=</span> <span class="fu">ones</span>(n)    <span class="co"># Length n vector of ones</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> <span class="fu">diagm</span>(<span class="cn">e</span>)   <span class="co"># Construct a diagonal matrix</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>e2 <span class="op">=</span> <span class="fu">diag</span>(D)   <span class="co"># Extract a matrix diagonal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The identity matrix in Julia is simply <code>I</code>. This is an abstract matrix with a size that can usually be inferred from context. In the rare cases when you need a <em>concrete</em> instantiation of an identity matrix, you can use <code>Matrix(I, n, n)</code>.</p>
</section>
<section id="concatenating-matrices-and-vectors" class="level3" data-number="2.8.2">
<h3 data-number="2.8.2" class="anchored" data-anchor-id="concatenating-matrices-and-vectors"><span class="header-section-number">2.8.2</span> Concatenating matrices and vectors</h3>
<p>In addition to functions for constructing specific types of matrices and vectors, Julia lets us put together matrices and vectors by horizontal and vertical concatenation. This works with matrices just as well as with vectors! Spaces are used for horizontal concatenation and semicolons for vertical concatenation.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> [<span class="fl">1</span>; <span class="fl">2</span>]        <span class="co"># Length-2 vector</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> [<span class="fl">1</span> <span class="fl">2</span>]         <span class="co"># 1-by-2 matrix</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> [<span class="fl">1</span> <span class="fl">2</span>; <span class="fl">3</span> <span class="fl">4</span>]    <span class="co"># 2-by-2 matrix</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> [I A]         <span class="co"># Horizontal matrix concatenation</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> [I; A]        <span class="co"># Vertical matrix concatenation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Julia uses commas to separate elements of a list-like data type or an array. So <code>[1, 2]</code> and <code>[1; 2]</code> give us the same thing (a length 2 vector), but <code>[I, A]</code> gives us a list consisting of a uniform scaling object and a matrix — not quite the same as horizontal matrix concatenation.</p>
</section>
<section id="transpose-and-rearrangemenent" class="level3" data-number="2.8.3">
<h3 data-number="2.8.3" class="anchored" data-anchor-id="transpose-and-rearrangemenent"><span class="header-section-number">2.8.3</span> Transpose and rearrangemenent</h3>
<p>Julia lets us rearrange the data inside a matrix or vector in a variety of ways. In addition to the usual transposition operation, we can also do “reshape” operations that let us interpret the same data layout in computer memory in different ways.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape A to a vector, then back to a matrix</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Julia is column-major</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>avec <span class="op">=</span> <span class="fu">reshape</span>(A, <span class="fu">prod</span>(<span class="fu">size</span>(A)));</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> <span class="fu">reshape</span>(avec, n, n)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="fu">randperm</span>(n)   <span class="co"># Random permutation of indices (need to use Random)</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>Ac <span class="op">=</span> A[<span class="op">:</span>,idx]       <span class="co"># Permute columns of A</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>Ar <span class="op">=</span> A[idx,<span class="op">:</span>]       <span class="co"># Permute rows of A</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>Ap <span class="op">=</span> A[idx,idx]     <span class="co"># Permute rows and columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="submatrices-diagonals-and-triangles" class="level3" data-number="2.8.4">
<h3 data-number="2.8.4" class="anchored" data-anchor-id="submatrices-diagonals-and-triangles"><span class="header-section-number">2.8.4</span> Submatrices, diagonals, and triangles</h3>
<p>Julia lets us extract specific parts of a matrix, like the diagonal entries or the upper or lower triangle. Some operations make separate copies of the data referenced:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> <span class="fu">randn</span>(<span class="fl">6</span>,<span class="fl">6</span>)    <span class="co"># 6-by-6 random matrix</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>A[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>]        <span class="co"># Leading 3-by-3 submatrix</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>A[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="kw">end</span>,<span class="op">:</span>]      <span class="co"># Rows 1, 3, 5</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>A[<span class="op">:</span>,<span class="fl">3</span><span class="op">:</span><span class="kw">end</span>]        <span class="co"># Columns 3-6</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>Ad <span class="op">=</span> <span class="fu">diag</span>(A)      <span class="co"># Diagonal of A (as vector)</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>A1 <span class="op">=</span> <span class="fu">diag</span>(A,<span class="fl">1</span>)    <span class="co"># First superdiagonal</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>Au <span class="op">=</span> <span class="fu">triu</span>(A)      <span class="co"># Upper triangle</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>Al <span class="op">=</span> <span class="fu">tril</span>(A)      <span class="co"># Lower triangle</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Other operations give a <em>view</em> of the matrix without making a copy of the contents, which can be much faster:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> <span class="fu">randn</span>(<span class="fl">6</span>,<span class="fl">6</span>)          <span class="co"># 6-by-6 random matrix</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(A,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>)         <span class="co"># View of leading 3-by-3 submatrix</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(A,<span class="op">:</span>,<span class="fl">3</span><span class="op">:</span><span class="kw">end</span>)         <span class="co"># View of columns 3-6</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>Au <span class="op">=</span> <span class="fu">UpperTriangular</span>(A) <span class="co"># View of upper triangle</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>Al <span class="op">=</span> <span class="fu">LowerTriangular</span>(A) <span class="co"># View of lower triangle</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="matrix-and-vector-operations" class="level3" data-number="2.8.5">
<h3 data-number="2.8.5" class="anchored" data-anchor-id="matrix-and-vector-operations"><span class="header-section-number">2.8.5</span> Matrix and vector operations</h3>
<p>Julia provides a variety of <em>elementwise</em> operations as well as linear algebraic operations. To distinguish elementwise multiplication or division from matrix multiplication and linear solves or least squares, we put a dot in front of the elementwise operations.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> d<span class="op">.*</span>x   <span class="co"># Elementwise multiplication of vectors/matrices</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x<span class="op">./</span>d   <span class="co"># Elementwise division</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> x <span class="op">+</span> y  <span class="co"># Add vectors/matrices</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> x <span class="op">.+</span> <span class="fl">1</span> <span class="co"># Add scalar to every element of a vector/matrix</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> A<span class="op">*</span>x    <span class="co"># Matrix times vector</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x<span class="op">'*</span>A   <span class="co"># Vector times matrix</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> A<span class="op">*</span>B    <span class="co"># Matrix times matrix</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't use inv!</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> A<span class="op">\</span>b    <span class="co"># Solve Ax = b *or* least squares</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> b<span class="op">/</span>A    <span class="co"># Solve yA = b or least squares</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="things-best-avoided" class="level3" data-number="2.8.6">
<h3 data-number="2.8.6" class="anchored" data-anchor-id="things-best-avoided"><span class="header-section-number">2.8.6</span> Things best avoided</h3>
<p>There are few good reasons to compute explicit matrix inverses or determinants in numerical computations. Julia does provide these operations. But if you find yourself typing <code>inv</code> or <code>det</code> in Julia, think long and hard. Is there an alternate formulation? Could you use the forward slash or backslash operations for solving a linear system?</p>
</section>
</section>
<section id="useful-packages" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="useful-packages"><span class="header-section-number">2.9</span> Useful packages</h2>
<p>Beyond the <code>LinearAlgebra</code> package mentioned in <a href="#sec-julia-linalg" class="quarto-xref"><span>Section 2.8</span></a>, there are several other packages that we will use or recommend in this book:</p>
<section id="statistics" class="level3" data-number="2.9.1">
<h3 data-number="2.9.1" class="anchored" data-anchor-id="statistics"><span class="header-section-number">2.9.1</span> Statistics</h3>
<p>The <code>Statistics</code> package provides a variety of standard statistics computations (mean, median, etc). There is also a <code>StatsBase</code> package that provides some additional statistics. There has been discussion of refactoring these.</p>
<p>The <code>StatsFuns</code> package provides a variety of special functions that occur in statistical computations (e.g.&nbsp;the log gamma function or various common pdf, cdf, and inverse cdf functions). The <code>Distributions</code> package is recommended as providing a more convenient interface, but sometimes we will want the low-level interface.</p>
</section>
<section id="sparse-matrices" class="level3" data-number="2.9.2">
<h3 data-number="2.9.2" class="anchored" data-anchor-id="sparse-matrices"><span class="header-section-number">2.9.2</span> Sparse matrices</h3>
<p>The <code>SparseArrays</code> package is generally useful for setting up sparse matrix and vectors. In addition, Julia provides packages for a variety of sparse direct and iterative solvers, including the <code>SuiteSparse</code> package (direct solvers) and the <code>IterativeSolvers</code> package (iterative solvers).</p>
</section>
<section id="dataframes" class="level3" data-number="2.9.3">
<h3 data-number="2.9.3" class="anchored" data-anchor-id="dataframes"><span class="header-section-number">2.9.3</span> DataFrames</h3>
<p>The <code>DataFrames</code> package provides functionality for manipulating tabular data similar to the Python <code>Pandas</code> package.</p>
</section>
<section id="automatic-differentiation" class="level3" data-number="2.9.4">
<h3 data-number="2.9.4" class="anchored" data-anchor-id="automatic-differentiation"><span class="header-section-number">2.9.4</span> Automatic differentiation</h3>
<p>Though we will only make limited use of these within the book, there are several Julia packages that support automatic differentiation, including <code>ForwardDiff</code>, <code>ReverseDiff</code>, <code>Zygote</code>, and <code>Enzyme</code>.</p>
</section>
<section id="plots-and-tables" class="level3" data-number="2.9.5">
<h3 data-number="2.9.5" class="anchored" data-anchor-id="plots-and-tables"><span class="header-section-number">2.9.5</span> Plots and tables</h3>
<p>The <code>Plots</code> package provides a standard interface for producing plots with a variety of plotting backends. There are other plotting packages in Julia (the second-most popular of which is probably <code>Makie</code>), but the <code>Plots</code> package makes a good starting point.</p>
<p>For text output of tabular data, we recommend the <code>PrettyTable</code> package. This can also write to a variety of output formats, including HTML, Markdown, and LaTeX.</p>
</section>
<section id="io" class="level3" data-number="2.9.6">
<h3 data-number="2.9.6" class="anchored" data-anchor-id="io"><span class="header-section-number">2.9.6</span> I/O</h3>
<p>The <code>FileIO</code> package provides a common interface for reading (and writing) a wide variety of data file types, including text, tabular, image, sound, and video formats.</p>
</section>
<section id="development-tools" class="level3" data-number="2.9.7">
<h3 data-number="2.9.7" class="anchored" data-anchor-id="development-tools"><span class="header-section-number">2.9.7</span> Development tools</h3>
<p>The <code>Test</code> package in Julia provides a variety of useful tools for writing unit tests. When tests fail and it is necessary to step through code, the <code>Debugger</code> package is useful. For performance evaluation, we recommend the <code>BenchmarkTools</code> and <code>Profile</code> packages.</p>
</section>
</section>
<section id="macros-and-metaprogramming" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="macros-and-metaprogramming"><span class="header-section-number">2.10</span> Macros and metaprogramming</h2>
<p>Julia provides a LISP-like <em>metaprogramming</em> facility that allows us to manipulate Julia code as data. This is a very powerful tool, allowing us to (for example) write <em>macros</em>, i.e.&nbsp;code that generates new code on our behalf. Metaprogramming requires care to get right, and the usual advice is to only use it when other tools do not suffice. However, there are some times when it really is the right tool, and so we will touch on it here at least lightly.</p>
<section id="code-as-data" class="level3" data-number="2.10.1">
<h3 data-number="2.10.1" class="anchored" data-anchor-id="code-as-data"><span class="header-section-number">2.10.1</span> Code as data</h3>
<p>The heart of metaprogramming is the understanding that code is a type of data, and can be manipulated as such. We distinguish code that we want to treat as data by <em>quoting</em> it, which involves bracketing the code by <code>:(</code> and <code>)</code> or by <code>quote</code> and <code>end</code>. For example, the expression</p>
<div id="03620b1b" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>quoted_sum <span class="op">=</span> <span class="op">:</span>(<span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>:(1 + 1)</code></pre>
</div>
</div>
<p>assigns <code>quoted_sum</code> to the unevaluated code for <code>1 + 1</code>. To evaluate the code, we can call the <code>eval</code> function</p>
<div id="472c105b" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(quoted_sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>2</code></pre>
</div>
</div>
<p>Quoted expressions are printed by the Julia interpreter in natural Julia syntax. Internally, though, these expressions are not represented by strings, but by <em>expression trees</em>. We can see the structure of the expresion tree with the <code>dump</code> command, e.g.</p>
<div id="d0c15b9d" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dump</span>(quoted_sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Expr
  head: Symbol call
  args: Array{Any}((3,))
    1: Symbol +
    2: Int64 1
    3: Int64 1</code></pre>
</div>
</div>
<p>The expression tree data structure involves internal nodes of type <code>expr</code> that have a <code>head</code> field indicating the type of operation represented, and an <code>args</code> array indicating the arguments of the operation. The leaves in the expression tree are literals, including symbols.</p>
<p>Just as we can use <em>string interpolation</em> to build strings that include computations, we can also use interpolation with quoted code; for example</p>
<div id="04b9130e" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>(<span class="op">$</span>x <span class="op">+</span> <span class="fl">1</span>)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>:(1 + 1)</code></pre>
</div>
</div>
<p>We can produce the same expression tree without quoting by explicitly using the constructor for <code>Expr</code> objects, e.g.</p>
<div id="a06444e7" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Expr</span>(<span class="op">:</span>call, <span class="op">:+</span>, x, <span class="fl">1</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>:(1 + 1)</code></pre>
</div>
</div>
</section>
<section id="macros" class="level3" data-number="2.10.2">
<h3 data-number="2.10.2" class="anchored" data-anchor-id="macros"><span class="header-section-number">2.10.2</span> Macros</h3>
<p>For the reader who <em>really</em> wants to learn to write macros, we recommend the documentation together with the book <a href="https://paulgraham.com/onlisp.html"><em>On Lisp</em></a> <span class="citation" data-cites="graham-1993">(<a href="../references.html#ref-graham-1993" role="doc-biblioref">Graham 1993</a>)</span>. We will write small macros a few times in order to simplify our life; and in any case, we also use macros written by others often enough that we are obliged to say a few words from a user’s perspective.</p>
<p>A macro maps a tuple of input expressions to an output expression, which is then compiled. The actual work of the macro code occurs at compile time; at run time, the system evaluates whatever output expression was generated by the macro. Macros are frequently used for various types of programming utilities. Debugging, timing, assertions, and formatted output in Julia are all conventionally done with macros.</p>
<p>The argument expressions can be parenthesized or not; for example, the following two lines are functionally identical invocations of the <code>@assert</code> macro:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@assert</span>(<span class="fu">f</span>(), <span class="st">"Call to f failed"</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@assert</span> <span class="fu">f</span>() <span class="st">"Call to f failed"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="a-toy-definition" class="level4" data-number="2.10.2.1">
<h4 data-number="2.10.2.1" class="anchored" data-anchor-id="a-toy-definition"><span class="header-section-number">2.10.2.1</span> A toy definition</h4>
<p>As a toy example, of a macro definition, consider a macro that prints the input expression</p>
<div id="cd035921" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="kw">macro</span> <span class="fu">printarg</span>(<span class="cn">e</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>e<span class="st"> = "</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quote</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> v <span class="op">=</span> <span class="op">$</span>e</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">println</span>(<span class="op">$</span>s, v)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>            v</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>@printarg (macro with 1 method)</code></pre>
</div>
</div>
<p>When calling a macro, we preface the name with an <code>@</code> sign; for example</p>
<div id="3b2cfd11" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@printarg</span> <span class="fl">1</span><span class="op">+</span><span class="fl">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 + 1 = 2</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>2</code></pre>
</div>
</div>
<p>This is essentially the functionality of the built-in <code>@show</code> macro, except that our <code>printarg</code> macro fails when the argument involves an expression with a variable. For example, <code>@show</code> works fine in this context, while <code>@printarg</code> would fail:</p>
<div id="9308fcbc" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> x <span class="op">+</span> x</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x + x = 2</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>2</code></pre>
</div>
</div>
<p>The problem has to do with the fact that Julia macros and rename variables internally when there is a possibility of accidental conflict with names in an outer environment in a local scope. To deliberately refer to a variable in the outer environment, that variable must be <em>escaped</em>. We can see the difference by expanding both the <code>@printarg</code> and the <code>@show</code> macros on the same input using the <code>@macroexpand</code> macro:</p>
<div id="51a8d7f7" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@macroexpand</span> <span class="pp">@printarg</span> x <span class="op">+</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div class="ansi-escaped-output">
<pre>quote
    <span class="ansi-bright-black-fg">#= In[40]:4 =#</span>
    let var"#97#v" = Main.x + Main.x
        <span class="ansi-bright-black-fg">#= In[40]:5 =#</span>
        Main.println("x + x = ", var"#97#v")
        <span class="ansi-bright-black-fg">#= In[40]:6 =#</span>
        var"#97#v"
    end
end</pre>
</div>
</div>
</div>
<p>We can see that all the variable names in this expression are explicitly scoped to the <code>Main</code> module. In contrast, for <code>@show</code>, we have</p>
<div id="0672937c" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@macroexpand</span> <span class="pp">@show</span> x <span class="op">+</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div class="ansi-escaped-output">
<pre>quote
    Base.println("x + x = ", Base.repr(begin
                <span class="ansi-bright-black-fg">#= show.jl:1181 =#</span>
                local var"#99#value" = x + x
            end))
    var"#99#value"
end</pre>
</div>
</div>
</div>
<p>Here we see that a local variable (with a name that will not conflict with any other name in the system) is assigned to the expression <code>x+x</code>.</p>
</section>
<section id="a-modest-example" class="level4" data-number="2.10.2.2">
<h4 data-number="2.10.2.2" class="anchored" data-anchor-id="a-modest-example"><span class="header-section-number">2.10.2.2</span> A modest example</h4>
<p>As an example of a more significant small utility macro, consider a closure defined inside of an outer function. Such closures sometimes suffer<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> from a performance issue because the compiler analysis does not determine that variables from the outer context (captured variables) are “type stable” (see <a href="02-Performance.html" class="quarto-xref"><span>Chapter 3</span></a>). Putting the function into a <code>let</code> block can help address the issue, e.g.&nbsp;replacing <code>{.julia} f = x -&gt; C*x</code> with <code>{.julia} f = let C=C x -&gt; C*x end</code> This does make a semantic change to the program; for example, the code <code>{.julia} C = 10 f = x -&gt; C*X C = 20 f(5)</code> will produce 100, while introducing an enclosing <code>let</code> block would produce 50. Nonetheless, in many cases captured variables remain unchanging for the useful lifetime of a closure, and this is a valid transformation.</p>
<p>Let us assume we are interested in automatically producing a surrounding <code>let</code> block. In this case, we first need a list of variables referenced in an expression. We do this by recursing through the call tree and adding any symbols we encounter (except for function names) to a set. Note that we can make this code very concise by defining different methods associated with the type of the first argument (dispatching based on an <code>Expr</code>, a <code>Symbol</code>, or another type)</p>
<div id="8e859e26" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">symbols!</span>(<span class="cn">e</span>, s <span class="op">=</span> <span class="fu">Set</span><span class="dt">{Symbol}</span>()) <span class="op">=</span> <span class="cn">nothing</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">symbols!</span>(<span class="cn">e</span> <span class="op">::</span><span class="dt"> Symbol</span>, s <span class="op">=</span> <span class="fu">Set</span><span class="dt">{Symbol}</span>()) <span class="op">=</span> <span class="fu">push!</span>(s, <span class="cn">e</span>)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">symbols!</span>(<span class="cn">e</span> <span class="op">::</span><span class="dt"> Expr</span>, s <span class="op">=</span> <span class="fu">Set</span><span class="dt">{Symbol}</span>())</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> <span class="cn">e</span>.head <span class="op">==</span> <span class="op">:</span>call ? <span class="cn">e</span>.args[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>] <span class="op">:</span> <span class="cn">e</span>.args</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> arg <span class="kw">in</span> args</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">symbols!</span>(arg, s)</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    s</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we are in a position to define the macro:</p>
<div id="d8038ce9" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="kw">macro</span> <span class="fu">letclosure</span>(<span class="cn">e</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check that this is a function definition with -&gt;</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@assert</span> <span class="cn">e</span>.head <span class="op">==</span> <span class="op">:</span>(<span class="op">-&gt;</span>)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the symbols that are not in the argument list</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="fu">Set</span><span class="dt">{Symbol}</span>()</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>    sarg <span class="op">=</span> <span class="fu">Set</span><span class="dt">{Symbol}</span>()</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">symbols!</span>(<span class="cn">e</span>.args[<span class="fl">2</span>], s)</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">symbols!</span>(<span class="cn">e</span>.args[<span class="fl">1</span>], sarg)</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setdiff!</span>(s, sarg)</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bind local variables to the outer version</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>    bindings <span class="op">=</span> [quote <span class="op">$</span>v <span class="op">=</span> <span class="op">$</span>(<span class="fu">esc</span>(v)) <span class="kw">end</span> for v <span class="kw">in</span> s]</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Put the expression into the let block</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quote</span></span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">$</span>(bindings<span class="op">...</span>)</span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">$</span>e</span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a few points to note about our definition:</p>
<ul>
<li><p>For local variables, the <code>macro</code> system produces “local” versions of names that do not coincide with any other names in the module. When we <em>want</em> such a coincidence, we need to explicitly escape a symbol with the <code>esc</code> function.</p></li>
<li><p>As in other contexts, the “splatting” operator (<code>$(bindings...)</code>) expands the contents of a list in place.</p></li>
</ul>
<p>When we evaluate the macro, the code is transformed and the result is inserted into our program; for example:</p>
<div id="4949a840" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> <span class="fl">10</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> <span class="pp">@letclosure</span> x <span class="op">-&gt;</span> C<span class="op">*</span>x</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> <span class="fl">20</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>(<span class="fl">5</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>50</code></pre>
</div>
</div>
<p>If we want to see how a macro expannds out to regular code, we can use the <code>@macroexpand</code> macro. Continuing with our example above, we have:</p>
<div id="c0ad78d0" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@macroexpand</span> <span class="pp">@letclosure</span> x <span class="op">-&gt;</span> C<span class="op">*</span>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div class="ansi-escaped-output">
<pre>quote
    <span class="ansi-bright-black-fg">#= In[46]:18 =#</span>
    let
        <span class="ansi-bright-black-fg">#= In[46]:19 =#</span>
        begin
            <span class="ansi-bright-black-fg">#= In[46]:14 =#</span>
            var"#103#C" = C
        end
        <span class="ansi-bright-black-fg">#= In[46]:20 =#</span>
        (var"#105#x",)-&gt;begin
                <span class="ansi-bright-black-fg">#= In[48]:1 =#</span>
                var"#103#C" * var"#105#x"
            end
    end
end</pre>
</div>
</div>
</div>
<p>Note in particular that in the variable bindings, the regular <code>C</code> appears on the right hand side, but a local version of <code>C</code> is assigned to. All the other variables in the generated code likewise have purely local names that are guaranteed not to coincide with other names in the module.</p>
</section>
</section>
</section>
<section id="a-matching-example" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="a-matching-example"><span class="header-section-number">2.11</span> A matching example</h2>
<p>Beyond writing language utilities, Julia macros are useful for writing embedded domain-specific languages (DSLs) for accomplishing particular tasks. In this setting, we are really writing a language interpreter embedded in Julia, using the Julia parse tree as an input and producing Julia code as output.</p>
<p>As an example of both Julia macro design and Julia programming more generally, we will design a small language extension for writing functions that transform code based on structural pattern matching; for example, a rule written as:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0</span><span class="op">-</span>x <span class="op">=&gt;</span> x <span class="op">-&gt;</span> <span class="op">-</span>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>corresponds to a function something like</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="cn">e</span> <span class="op">-&gt;</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check that e is a binary minus and the first argument is zero.</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="cn">e</span> isa <span class="dt">Expr</span> <span class="op">&amp;&amp;</span> <span class="cn">e</span>.head <span class="op">==</span> <span class="op">:</span>call <span class="op">&amp;&amp;</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>        <span class="cn">e</span>.args[<span class="fl">1</span>] <span class="op">==</span> <span class="op">:-</span> <span class="op">&amp;&amp;</span> <span class="fu">length</span>(<span class="cn">e</span>.args) <span class="op">==</span> <span class="fl">3</span> <span class="op">&amp;&amp;</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>        <span class="cn">e</span>.args[<span class="fl">2</span>] <span class="op">==</span> <span class="fl">0</span>)</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Bind the name "x" to the second argument</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> x <span class="op">=</span> <span class="cn">e</span>.args[<span class="fl">3</span>]</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> <span class="op">:</span>(<span class="op">-$</span>x)   <span class="co"># Create a "-x" expression</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>            <span class="cn">true</span>, result      <span class="co"># Yes it matched, return result</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>    else</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>        <span class="cn">false</span>, <span class="cn">nothing</span>        <span class="co"># No, it didn't match</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That is, we want a function that takes an input</p>
<ul>
<li>Is this an expression with a binary <code>-</code> operation at the top?</li>
<li>Is the second term in the sum a zero?</li>
<li>If both are true, bind <code>x</code> to the second term in the sum, produce a new expression <code>:(-$x)</code>, and assign to <code>result</code>. Return the pair <code>(true, result)</code>.</li>
<li>Otherwise, return <code>(false, nothing)</code>.</li>
</ul>
<p>The one-line description is already more concise for this simple example; if we wanted to match against a more complicated pattern, the Julia code corresponding to a rule in the syntax</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=&gt;</span> (argument_symbols) <span class="op">-&gt;</span> result_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>becomes that much more complex. Our key task is therefore take rules written with the first syntax and to convert them automatically to standard functions.</p>
<p>This is a more ambitious example, and can be safely skipped over. However, it is both a useful example of a variety of features in Julia and introduces concrete tools we will use in later chapters (e.g.&nbsp;when discussing automatic differentiation).</p>
<section id="preprocessing" class="level3" data-number="2.11.1">
<h3 data-number="2.11.1" class="anchored" data-anchor-id="preprocessing"><span class="header-section-number">2.11.1</span> Preprocessing</h3>
<p>The parse tree for Julia code includes not only expressions, but also <em>line numbers</em>, e.g.</p>
<div id="1a46c9c1" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="op">:</span>(x<span class="op">-&gt;</span>x<span class="op">+</span><span class="fl">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div class="ansi-escaped-output">
<pre>:(x-&gt;begin
          <span class="ansi-bright-black-fg">#= In[49]:1 =#</span>
          x + 1
      end)</pre>
</div>
</div>
</div>
<p>In the code shown, the comment line immediately after the <code>begin</code> statement corresponds to a <code>LineNumberNode</code>. Such <code>LineNumberNode</code> nodes are useful for debugging, but are a nuisance for our attempts at pattern matching. Therefore, before doing anything else, we will write a utility to get rid of such nodes. Because <code>LineNumberNode</code> is a distinct type, we can use Julia’s multiple dispatch as an easy way to accomplish this.</p>
<div id="05371ddf" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter_line_numbers</span>(<span class="cn">e</span> <span class="op">::</span><span class="dt"> Expr</span>) <span class="op">=</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> args <span class="op">=</span> <span class="fu">filter</span>(a <span class="op">-&gt;</span> !(a isa LineNumberNode), <span class="cn">e</span>.args)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Expr</span>(<span class="cn">e</span>.head, <span class="fu">filter_line_numbers</span>.(args)<span class="op">...</span>)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter_line_numbers</span>(<span class="cn">e</span>) <span class="op">=</span> <span class="cn">e</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="matching" class="level3" data-number="2.11.2">
<h3 data-number="2.11.2" class="anchored" data-anchor-id="matching"><span class="header-section-number">2.11.2</span> Matching</h3>
<p>At the heart of our matching algorithm will be a function <code>match_gen</code> that generates code to check whether an expression matches a pattern. The inputs to the <code>match_gen</code> function are</p>
<ul>
<li>A dictionary of <em>bindings</em>, mapping symbols to values.</li>
<li>A pattern</li>
<li>A symbol naming the current expression being matched.</li>
</ul>
<section id="literals" class="level4" data-number="2.11.2.1">
<h4 data-number="2.11.2.1" class="anchored" data-anchor-id="literals"><span class="header-section-number">2.11.2.1</span> Literals</h4>
<p>In the simplest case, for non-symbol leaf nodes, we declare a match when the pattern agrees with the expression.</p>
<div id="41a81b15" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match_gen!</span>(bindings, <span class="cn">e</span>, pattern) <span class="op">=</span> <span class="op">:</span>(<span class="op">$</span>e <span class="op">==</span> <span class="op">$</span>pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, the following code matches the expression named <code>expr</code> to the pattern <code>0</code>:</p>
<div id="a690dfa2" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match_gen!</span>(<span class="fu">Dict</span>(), <span class="op">:</span>expr, <span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>:(expr == 0)</code></pre>
</div>
</div>
</section>
<section id="symbols" class="level4" data-number="2.11.2.2">
<h4 data-number="2.11.2.2" class="anchored" data-anchor-id="symbols"><span class="header-section-number">2.11.2.2</span> Symbols</h4>
<p>Things are more complicated when we match a symbol. If the symbol is not in the bindings dictionary, we just check that the expression equals the (quoted) symbol. Otherwise, there are two cases:</p>
<ul>
<li><em>First use</em>: we create a new binding for it.</li>
<li><em>Repeat use</em>: Check if <code>expr</code> matches the previous binding.</li>
</ul>
<div id="2798faa6" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match_gen!</span>(bindings, <span class="cn">e</span>, s <span class="op">::</span><span class="dt"> Symbol</span>) <span class="op">=</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> !(s <span class="kw">in</span> <span class="fu">keys</span>(bindings))</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>        qs <span class="op">=</span> <span class="fu">QuoteNode</span>(s)</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>(<span class="op">$</span>e <span class="op">==</span> <span class="op">$</span>qs)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> bindings[s] <span class="op">==</span> <span class="cn">nothing</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>        binding <span class="op">=</span> <span class="fu">gensym</span>()</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>        bindings[s] <span class="op">=</span> binding</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">quote</span> <span class="op">$</span>binding <span class="op">=</span> <span class="op">$</span>e; <span class="cn">true</span> <span class="cf">end</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>    else</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>        binding <span class="op">=</span> bindings[s]</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>(<span class="op">$</span>e <span class="op">==</span> <span class="op">$</span>binding)</span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We illustrate all three cases below.</p>
<div id="4b3d0866" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>    bindings <span class="op">=</span> <span class="fu">Dict</span><span class="dt">{Symbol,Any}</span>(<span class="op">:</span>x <span class="op">=&gt;</span> <span class="cn">nothing</span>)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>( <span class="fu">match_gen!</span>(bindings, <span class="op">:</span>expr, <span class="op">:</span>x) )</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>( <span class="fu">match_gen!</span>(bindings, <span class="op">:</span>expr, <span class="op">:</span>x) )</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>( <span class="fu">match_gen!</span>(bindings, <span class="op">:</span>expr, <span class="op">:</span>y) )</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>begin
    #= In[53]:8 =#
    var"##226" = expr
    #= In[53]:8 =#
    true
end
expr == var"##226"
expr == :y</code></pre>
</div>
</div>
</section>
<section id="expressions" class="level4" data-number="2.11.2.3">
<h4 data-number="2.11.2.3" class="anchored" data-anchor-id="expressions"><span class="header-section-number">2.11.2.3</span> Expressions</h4>
<p>The most complex case is matching expressions. The basics are not complicated: an item <code>e</code> matches an <code>Expr</code> pattern if <code>e</code> is an expression with the same head as the pattern and if the arguments match.</p>
<div id="4ca2f74d" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match_gen!</span>(bindings, <span class="cn">e</span>, pattern <span class="op">::</span><span class="dt"> Expr</span>) <span class="op">=</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> head <span class="op">=</span> <span class="fu">QuoteNode</span>(pattern.head),</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>        argmatch <span class="op">=</span> <span class="fu">match_gen_args!</span>(bindings, <span class="cn">e</span>, pattern.args)</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>( <span class="op">$</span>e isa <span class="dt">Expr</span> <span class="op">&amp;&amp;</span> <span class="op">$</span>e.head <span class="op">==</span> <span class="op">$</span>head <span class="op">&amp;&amp;</span> <span class="op">$</span>argmatch )</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The building block for checking the arguments will be to check that a list of expressions matches a list of patterns.</p>
<div id="6706fc6c" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match_gen_lists!</span>(bindings, exprs, patterns) <span class="op">=</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foldr</span>((x,y) <span class="op">-&gt;</span> <span class="fu">Expr</span>(<span class="op">:</span>(<span class="op">&amp;&amp;</span>), x, y),</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>          [<span class="fu">match_gen!</span>(bindings, <span class="cn">e</span>, p)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>           for (<span class="cn">e</span>,p) <span class="kw">in</span> <span class="fu">zip</span>(exprs, patterns)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The more complicated case is ensuring that the arguments match. This is in part because we want to accomodate the possibility that the last argument in the list is “splatted”; that is, a pattern like <code>f(args...)</code> should match <code>f(1, 2, 3)</code> with <code>args</code> bound to the tuple <code>[1, 2, 3]</code>. In order to do this, we would first like to make sure that we can sensibly identify a “splatted argument.”</p>
<div id="dd60325b" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_splat_arg</span>(bindings, <span class="cn">e</span>) <span class="op">=</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>    <span class="cn">e</span> isa <span class="dt">Expr</span> <span class="op">&amp;&amp;</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>    <span class="cn">e</span>.head <span class="op">==</span> <span class="op">:</span>(<span class="op">...</span>) <span class="op">&amp;&amp;</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">e</span>.args[<span class="fl">1</span>] isa <span class="dt">Symbol</span> <span class="op">&amp;&amp;</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">e</span>.args[<span class="fl">1</span>] <span class="kw">in</span> <span class="fu">keys</span>(bindings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we only consider something a “splatted argument” if the argument to the splat operator is a symbol in the bindings table.</p>
<p>To implement the check, we create a <code>let</code> statement to bind a local name to each argument. If the last pattern is splatted, we make sure the last term in the tuple on the left-hand side of the statement is splatted (and then remove the pattern splat). Finally, we generate checks to make sure each of the locally-named arguments matches with the associated term in the pattern list.</p>
<div id="34a4bc10" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match_gen_args!</span>(bindings, <span class="cn">e</span>, patterns) <span class="op">=</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">isempty</span>(patterns)</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>(<span class="fu">length</span>(<span class="op">$</span>e.args) <span class="op">==</span> <span class="fl">0</span>)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>        nargs <span class="op">=</span> <span class="fu">length</span>(patterns)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>        lencheck <span class="op">=</span> <span class="op">:</span>(<span class="fu">length</span>(<span class="op">$</span>e.args) <span class="op">==</span> <span class="op">$</span>nargs)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>        args <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Any}</span>([<span class="fu">gensym</span>() for j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(patterns)])</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>        argstuple <span class="op">=</span> <span class="fu">Expr</span>(<span class="op">:</span>tuple, args<span class="op">...</span>)</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># De-splat pattern / splat arg assignment and</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   adjust the length check</span></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">is_splat_arg</span>(bindings, patterns[<span class="kw">end</span>])</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>            patterns <span class="op">=</span> <span class="fu">copy</span>(patterns)</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>            patterns[<span class="kw">end</span>] <span class="op">=</span> patterns[<span class="kw">end</span>].args[<span class="fl">1</span>]</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>            argstuple.args[<span class="kw">end</span>] <span class="op">=</span> <span class="fu">Expr</span>(<span class="op">:</span>(<span class="op">...</span>), argstuple.args[<span class="kw">end</span>])</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>            lencheck <span class="op">=</span> <span class="op">:</span>(<span class="fu">length</span>(<span class="op">$</span>e.args) <span class="op">&gt;=</span> <span class="op">$</span>(nargs<span class="op">-</span><span class="fl">1</span>))</span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a>        argchecks <span class="op">=</span> <span class="fu">match_gen_lists!</span>(bindings, args, patterns)</span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>(<span class="op">$</span>lencheck <span class="op">&amp;&amp;</span> <span class="kw">let</span> <span class="op">$</span>argstuple <span class="op">=</span> <span class="op">$</span>e.args; <span class="op">$</span>argchecks <span class="cf">end</span>)</span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We strongly recommend the reader trace through this code for some examples until enlightenment strikes.</p>
</section>
<section id="compiling-the-match" class="level4" data-number="2.11.2.4">
<h4 data-number="2.11.2.4" class="anchored" data-anchor-id="compiling-the-match"><span class="header-section-number">2.11.2.4</span> Compiling the match</h4>
<p>Given a list of symbols and a pattern in which they appear, we can produce code to generate a mapping from expressions to either <code>(true,bindings)</code> where <code>bindings</code> is a list of all the subexpressions bound to the name list; or <code>(false, nothing)</code> if there is no match.</p>
<div id="e0889fbf" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">compile_matcher</span>(symbols, pattern)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>    bindings <span class="op">=</span> <span class="fu">Dict</span><span class="dt">{Symbol,Any}</span>(s <span class="op">=&gt;</span> <span class="cn">nothing</span> <span class="cf">for</span> s <span class="kw">in</span> symbols)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input expression symbol and matching code</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (symbol bindings are indicated by bindings table)</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>    expr <span class="op">=</span> <span class="fu">gensym</span>()</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> <span class="fu">match_gen!</span>(bindings, expr, pattern)</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get result vals (symbol/nothing) and associated variable names</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>    result_vals <span class="op">=</span> [bindings[s] for s <span class="kw">in</span> symbols]</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>    declarations <span class="op">=</span> <span class="fu">filter</span>(x <span class="op">-&gt;</span> x <span class="op">!=</span> <span class="cn">nothing</span>, result_vals)</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Produce the matching code</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> <span class="fu">Expr</span>(<span class="op">:</span>tuple, result_vals<span class="op">...</span>)</span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>(<span class="op">$</span>expr <span class="op">-&gt;</span></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="op">$</span>(declarations<span class="op">...</span>)</span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">$</span>test</span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a>                (<span class="cn">true</span>, <span class="op">$</span>results)</span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a>                (<span class="cn">false</span>, <span class="cn">nothing</span>)</span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span>)</span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is convenient to compile this into a macro. The macro version also filters line numbers out of the input pattern and out of any exprssion we are trying to match.</p>
<div id="6c5f0327" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="kw">macro</span> <span class="fu">match</span>(symbols, pattern)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@assert</span>(symbols.head <span class="op">==</span> <span class="op">:</span>tuple <span class="op">&amp;&amp;</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">all</span>(<span class="fu">isa</span>.(symbols.args, <span class="dt">Symbol</span>)),</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Invalid input symbol list"</span>)</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> <span class="fu">filter_line_numbers</span>(pattern)</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>    matcher <span class="op">=</span> <span class="fu">compile_matcher</span>(symbols.args, pattern)</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>(<span class="op">$</span>matcher <span class="op">∘</span> filter_line_numbers)</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="rules" class="level3" data-number="2.11.3">
<h3 data-number="2.11.3" class="anchored" data-anchor-id="rules"><span class="header-section-number">2.11.3</span> Rules</h3>
<p>A rule has the form</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=&gt;</span> args <span class="op">-&gt;</span> code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>args</code> is the list of names that are bound in the pattern, and these names can be used in the subsequent code. We want to allow the code to potentially use not only the matched subexpression, but also to refer to the symbol as a whole; we use the named argument feature in tuples for that. So, for example, in the rule</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">-</span> y <span class="op">=&gt;</span> (x,y;<span class="cn">e</span>) <span class="op">-&gt;</span> <span class="fu">process</span>(<span class="cn">e</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>we mean to match any subtraction, bind the operands to <code>x</code> and <code>y</code> and the expression as a whole to <code>e</code>, and call <code>process(e)</code> to process the expression.</p>
<p>Now that we have a macro for computing matches, we can use it to help with parsing the rule declarations into argument names, expression name (if present), the pattern, and the code to be called on a match.</p>
<div id="60d4bbb3" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">parse_rule</span>(rule)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>    match_rule <span class="op">=</span> <span class="pp">@match</span> (pattern, args, code) pattern <span class="op">=&gt;</span> args <span class="op">-&gt;</span> code</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>    isok, rule_parts <span class="op">=</span> <span class="fu">match_rule</span>(rule)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> !isok</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">error</span>(<span class="st">"Syntax error in rule </span><span class="sc">$</span>rule<span class="st">"</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    pattern, args, code <span class="op">=</span> rule_parts</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>    match_arg1 <span class="op">=</span> <span class="pp">@match</span> (args, expr) (args<span class="op">...</span>, ; expr)</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>    match_arg2 <span class="op">=</span> <span class="pp">@match</span> (args, expr) (args<span class="op">...</span>, )</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">begin</span> ismatch, bindings <span class="op">=</span> <span class="fu">match_arg1</span>(args); ismatch <span class="cf">end</span> <span class="op">||</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">begin</span> ismatch, bindings <span class="op">=</span> <span class="fu">match_arg2</span>(args); ismatch <span class="cf">end</span> <span class="op">||</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">begin</span> bindings <span class="op">=</span> (<span class="fu">Vector</span><span class="dt">{Any}</span>([args]), <span class="cn">nothing</span>) <span class="cf">end</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>    symbols, expr_name <span class="op">=</span> bindings</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> !<span class="fu">all</span>(<span class="fu">isa</span>.(symbols, <span class="dt">Symbol</span>))</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">error</span>(<span class="st">"Arguments should all be symbols in </span><span class="sc">$</span>symbols<span class="st">"</span>)</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> !(expr_name <span class="op">==</span> <span class="cn">nothing</span> <span class="op">||</span> expr_name isa <span class="dt">Symbol</span>)</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">error</span>(<span class="st">"Expression parameter should be a symbol"</span>)</span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>    symbols, expr_name, pattern, code</span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Matching a pattern on an input produces a boolean variable (whether there was a match or not) and a table of bindings from names in the pattern to symbols generated during the match. In order to safely access the right-hand-side symbols that were generated during the match, we need to declare them (in a <code>let</code> statement). If there is a match, we bind them to the ordinary input names (things like <code>:x</code>) in a second let statement, then call the code in that second let statement and assign the result to the <code>result</code> symbol. The resulting code must be used in a context where the <code>expr</code> and <code>result</code> symbols are already set up.</p>
<div id="19e063f7" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">compile_rule</span>(rule, expr, result)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>    symbols, expr_name, pattern, code <span class="op">=</span> <span class="fu">parse_rule</span>(rule)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    bindings <span class="op">=</span> <span class="fu">Dict</span><span class="dt">{Symbol,Any}</span>(s <span class="op">=&gt;</span> <span class="cn">nothing</span> <span class="cf">for</span> s <span class="kw">in</span> symbols)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> <span class="fu">match_gen!</span>(bindings, expr, pattern)</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get list of match symbols and associated declarations</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>    result_vals <span class="op">=</span> [bindings[s] for s <span class="kw">in</span> symbols]</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    declarations <span class="op">=</span> <span class="fu">filter</span>(x <span class="op">-&gt;</span> x <span class="op">!=</span> <span class="cn">nothing</span>, result_vals)</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set up local bindings of argument names in code</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>    binding_code <span class="op">=</span> [<span class="op">:</span>(<span class="op">$</span>s <span class="op">=</span> <span class="op">$</span>(r <span class="op">==</span> <span class="cn">nothing</span> ? (<span class="op">:</span><span class="cn">nothing</span>) <span class="op">:</span> r))</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>                    for (s,r) <span class="kw">in</span> <span class="fu">zip</span>(symbols, result_vals)]</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> expr_name <span class="op">!=</span> <span class="cn">nothing</span></span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(binding_code, <span class="op">:</span>(<span class="op">$</span>expr_name <span class="op">=</span> <span class="op">$</span>expr))</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Produce the rule</span></span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>    ismatch <span class="op">=</span> <span class="fu">gensym</span>()</span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quote</span></span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="op">$</span>(declarations<span class="op">...</span>)</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">$</span>ismatch <span class="op">=</span> <span class="op">$</span>test</span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">$</span>ismatch</span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>                <span class="op">$</span>result <span class="op">=</span> <span class="kw">let</span> <span class="op">$</span>(binding_code<span class="op">...</span>); <span class="op">$</span>code <span class="cf">end</span></span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">$</span>ismatch</span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we are able to compile a rule, we set up a macro for compiling a rule into a standalone function. The input expression symbol (<code>expr</code>) is the named argument to this standalone function, and at the end the function returns both the match condition (which is what the compiled code evaluates to) and the result (which the compiled code produces as a side effect).</p>
<div id="17317562" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="kw">macro</span> <span class="fu">rule</span>(r)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>    expr, result <span class="op">=</span> <span class="fu">gensym</span>(), <span class="fu">gensym</span>()</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    code <span class="op">=</span> <span class="fu">compile_rule</span>(<span class="fu">filter_line_numbers</span>(r), expr, result)</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">esc</span>(<span class="kw">quote</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">$</span>expr <span class="op">-&gt;</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="op">$</span>result <span class="op">=</span> <span class="cn">nothing</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>                    <span class="op">$</span>code, <span class="op">$</span>result</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>                <span class="kw">end</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span>)</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we often want to combine rules, executing the first one that matches a given input. The <code>@rules</code> macro takes a set of rules packaged into a block and tries them in sequence, returning the result of whichever rule was executed (or <code>nothing</code> if no rule was executed).</p>
<div id="c22c8124" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="kw">macro</span> <span class="fu">rules</span>(rblock <span class="op">::</span><span class="dt"> Expr</span>)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>    rblock <span class="op">=</span> <span class="fu">filter_line_numbers</span>(rblock)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rblock.head <span class="op">!=</span> <span class="op">:</span>block</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">error</span>(<span class="st">"Rules must be in a begin/end block"</span>)</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set up input name, output name, and rule list</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>    expr, result <span class="op">=</span> <span class="fu">gensym</span>(), <span class="fu">gensym</span>()</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>    rules <span class="op">=</span> rblock.args</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Or together all the tests</span></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>    rule_calls <span class="op">=</span> </span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">foldr</span>((x,y) <span class="op">-&gt;</span> <span class="fu">Expr</span>(<span class="op">:</span>(<span class="op">||</span>), x, y),</span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>              [<span class="fu">compile_rule</span>(r, expr, result) for r <span class="kw">in</span> rules])</span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call all the rules, return the computed result</span></span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">esc</span>(<span class="kw">quote</span></span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">$</span>expr <span class="op">-&gt;</span></span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> <span class="op">$</span>result <span class="op">=</span> <span class="cn">nothing</span></span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">$</span>rule_calls</span>
<span id="cb161-21"><a href="#cb161-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">$</span>result</span>
<span id="cb161-22"><a href="#cb161-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">end</span></span>
<span id="cb161-23"><a href="#cb161-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span>)</span>
<span id="cb161-24"><a href="#cb161-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="examples" class="level3" data-number="2.11.4">
<h3 data-number="2.11.4" class="anchored" data-anchor-id="examples"><span class="header-section-number">2.11.4</span> Examples</h3>
<p>We conclude our matching example by giving a few examples of the process in practice.</p>
<section id="re-associating-operations" class="level4" data-number="2.11.4.1">
<h4 data-number="2.11.4.1" class="anchored" data-anchor-id="re-associating-operations"><span class="header-section-number">2.11.4.1</span> Re-associating operations</h4>
<p>Julia parses chains of additions and multiplications into one long list. For example, <code>1+2+3</code> parses to <code>(1+2)+3</code> rather than to <code>+(+(1,2), 3)</code>. For some operations, it is simpler to only allow binary addition and multiplication nodes. The following function converts these nodes.</p>
<div id="a813ead7" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">reassoc_addmul</span>(<span class="cn">e</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply folding to an op(args...) node (op = +, *)</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fold_args</span>(args, op) <span class="op">=</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">foldl</span>((x,y) <span class="op">-&gt;</span> <span class="fu">Expr</span>(<span class="op">:</span>call, op, x, y), args)</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rules for processing one expression node</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="pp">@rules</span> <span class="cf">begin</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">+</span>(args<span class="op">...</span>) <span class="op">=&gt;</span> args <span class="op">-&gt;</span> <span class="fu">fold_args</span>(args, <span class="op">:+</span>)</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">*</span>(args<span class="op">...</span>) <span class="op">=&gt;</span> args <span class="op">-&gt;</span> <span class="fu">fold_args</span>(args, <span class="op">:*</span>)</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>        <span class="cn">e</span> <span class="op">=&gt;</span> <span class="cn">e</span> <span class="op">-&gt;</span> <span class="cn">e</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recursively process the graph</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span> <span class="op">::</span><span class="dt"> Expr</span>) <span class="op">=</span> <span class="fu">r</span>(<span class="fu">Expr</span>(<span class="cn">e</span>.head, <span class="fu">process</span>.(<span class="cn">e</span>.args)<span class="op">...</span>))</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span>) <span class="op">=</span> <span class="cn">e</span></span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process the input expression</span></span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span>)</span>
<span id="cb162-20"><a href="#cb162-20" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, the following expression has both long sums and long products that we re-associate into binary operations.</p>
<div id="b7fcf634" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>    <span class="cn">e</span> <span class="op">=</span> <span class="op">:</span>(<span class="fu">sin</span>(<span class="fl">1</span><span class="op">+</span><span class="fl">2</span><span class="op">+</span><span class="fl">3</span><span class="op">*</span><span class="fl">4</span><span class="op">*</span>f))</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"Original:    </span><span class="sc">$</span>e<span class="st">"</span>)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"Transformed: </span><span class="sc">$</span>(<span class="fu">reassoc_addmul</span>(<span class="cn">e</span>))<span class="st">"</span>)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original:    sin(1 + 2 + 3 * 4 * f)
Transformed: sin((1 + 2) + (3 * 4) * f)</code></pre>
</div>
</div>
<p>If we wanted to, we could also “de-associate” by collapsing sums and multiplications into single nodes.</p>
<div id="16858b17" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">deassociate</span>(<span class="cn">e</span>)</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="pp">@rules</span> <span class="cf">begin</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>        x <span class="op">*</span> (<span class="fu">*</span>(args<span class="op">...</span>)) <span class="op">=&gt;</span> (x, args) <span class="op">-&gt;</span> <span class="fu">Expr</span>(<span class="op">:</span>call, <span class="op">:*</span>, x, args<span class="op">...</span>)</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">*</span>(args<span class="op">...</span>)) <span class="op">*</span> x <span class="op">=&gt;</span> (args, x) <span class="op">-&gt;</span> <span class="fu">Expr</span>(<span class="op">:</span>call, <span class="op">:*</span>, args<span class="op">...</span>, x)</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>        x <span class="op">+</span> (<span class="fu">+</span>(args<span class="op">...</span>)) <span class="op">=&gt;</span> (x, args) <span class="op">-&gt;</span> <span class="fu">Expr</span>(<span class="op">:</span>call, <span class="op">:+</span>, x, args<span class="op">...</span>)</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">+</span>(args<span class="op">...</span>)) <span class="op">+</span> x <span class="op">=&gt;</span> (args, x) <span class="op">-&gt;</span> <span class="fu">Expr</span>(<span class="op">:</span>call, <span class="op">:+</span>, args<span class="op">...</span>, x)</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>        <span class="cn">e</span> <span class="op">=&gt;</span> <span class="cn">e</span> <span class="op">-&gt;</span> <span class="cn">e</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span> <span class="op">::</span><span class="dt"> Expr</span>) <span class="op">=</span> <span class="fu">r</span>(<span class="fu">Expr</span>(<span class="cn">e</span>.head, <span class="fu">process</span>.(<span class="cn">e</span>.args)<span class="op">...</span>))</span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span>) <span class="op">=</span> <span class="cn">e</span></span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span>)</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We take the output of our “reassociate” code as an example input.</p>
<div id="dda059f0" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deassociate</span>(<span class="op">:</span>(<span class="fu">sin</span>((<span class="fl">1</span><span class="op">+</span><span class="fl">2</span>) <span class="op">+</span> (<span class="fl">3</span><span class="op">*</span><span class="fl">4</span>)<span class="op">*</span>f)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>:(sin(1 + 2 + 3 * 4 * f))</code></pre>
</div>
</div>
</section>
<section id="simplifying-expressions" class="level4" data-number="2.11.4.2">
<h4 data-number="2.11.4.2" class="anchored" data-anchor-id="simplifying-expressions"><span class="header-section-number">2.11.4.2</span> Simplifying expressions</h4>
<p>Automatically-generated code of the sort that comes out of naive automatic differentiation often involves operations that can be easily simplified by removing additions with zeros, multiplications with one, and so forth. For example, we write <code>simplify_sum</code> and <code>simplify_mul</code> routines to handle simplification of sums and products involving zeros and ones.</p>
<div id="874f9db2" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simplify_sum</span>(args) <span class="op">=</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> args <span class="op">=</span> <span class="fu">filter</span>(x <span class="op">-&gt;</span> x <span class="op">!=</span> <span class="fl">0</span>, args)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">length</span>(args) <span class="op">==</span> <span class="fl">1</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>            args[<span class="fl">1</span>]</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">Expr</span>(<span class="op">:</span>call, <span class="op">:+</span>, args<span class="op">...</span>)</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a><span class="fu">simplify_mul</span>(args) <span class="op">=</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> args <span class="op">=</span> <span class="fu">filter</span>(x <span class="op">-&gt;</span> x <span class="op">!=</span> <span class="fl">1</span>, args)</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">any</span>(args <span class="op">.==</span> <span class="fl">0</span>)</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0</span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elseif</span> <span class="fu">length</span>(args) <span class="op">==</span> <span class="fl">1</span></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>            args[<span class="fl">1</span>]</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">Expr</span>(<span class="op">:</span>call, <span class="op">:*</span>, args<span class="op">...</span>)</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Building on simplifying sums and products, we can recurse up and down an expression tree to apply these and other similar rules.</p>
<div id="578cd8cc" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">simplify</span>(<span class="cn">e</span>)</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="pp">@rules</span> <span class="cf">begin</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">+</span>(args<span class="op">...</span>) <span class="op">=&gt;</span> args <span class="op">-&gt;</span> <span class="fu">simplify_sum</span>(args)</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">*</span>(args<span class="op">...</span>) <span class="op">=&gt;</span> args <span class="op">-&gt;</span> <span class="fu">simplify_mul</span>(args)</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>        x <span class="op">-</span> <span class="fl">0</span> <span class="op">=&gt;</span> x <span class="op">-&gt;</span> x</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0</span> <span class="op">-</span> x <span class="op">=&gt;</span> x <span class="op">-&gt;</span> <span class="op">:</span>(<span class="op">-$</span>x)</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">-</span>(<span class="fl">0</span>)  <span class="op">=&gt;</span> (;x) <span class="op">-&gt;</span> <span class="fl">0</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>        x <span class="op">/</span> <span class="fl">1</span> <span class="op">=&gt;</span> x <span class="op">-&gt;</span> x</span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0</span> <span class="op">/</span> x <span class="op">=&gt;</span> x <span class="op">-&gt;</span> <span class="fl">0</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>        x <span class="op">^</span> <span class="fl">1</span> <span class="op">=&gt;</span> x <span class="op">-&gt;</span> x</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>        x <span class="op">^</span> <span class="fl">0</span> <span class="op">=&gt;</span> x <span class="op">-&gt;</span> <span class="fl">1</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>        <span class="cn">e</span>     <span class="op">=&gt;</span> <span class="cn">e</span> <span class="op">-&gt;</span> <span class="cn">e</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span> <span class="op">::</span><span class="dt"> Expr</span>) <span class="op">=</span> <span class="fu">r</span>(<span class="fu">Expr</span>(<span class="cn">e</span>.head, <span class="fu">process</span>.(<span class="cn">e</span>.args)<span class="op">...</span>))</span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span>) <span class="op">=</span> <span class="cn">e</span></span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process</span>(<span class="cn">e</span>)</span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We illustrate our simplifier with some operations</p>
<div id="7daa218e" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compare</span>(<span class="cn">e</span>) <span class="op">=</span> <span class="fu">println</span>(<span class="st">"</span><span class="sc">$</span>e<span class="st"> simplifies to </span><span class="sc">$</span>(<span class="fu">simplify</span>(<span class="cn">e</span>))<span class="st">"</span>)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compare</span>(<span class="op">:</span>(<span class="fl">0</span><span class="op">*</span>x <span class="op">+</span> C<span class="op">*</span>dx))</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compare</span>(<span class="op">:</span>(<span class="fl">2</span><span class="op">*</span>x<span class="op">^</span><span class="fl">1</span><span class="op">*</span>dx))</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compare</span>(<span class="op">:</span>(<span class="fl">1</span><span class="op">*</span>x<span class="op">^</span><span class="fl">0</span><span class="op">*</span>dx))</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0 * x + C * dx simplifies to C * dx
2 * x ^ 1 * dx simplifies to 2 * x * dx
1 * x ^ 0 * dx simplifies to dx</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="elements-of-julia-style" class="level2" data-number="2.12">
<h2 data-number="2.12" class="anchored" data-anchor-id="elements-of-julia-style"><span class="header-section-number">2.12</span> Elements of Julia style</h2>
<p>We write programs to be executed by a computer, an unforgivingly literal-minded audience. But the humans who read our code are a more challenging audience by far. We humans get bored. We get sidetracked. We misunderstand the simple things, and declare that we understand complicated things based on only-partly-correct models of how the world works. We read, forget, read again, and forget again. In the face of such an audience, what’s a programmer to do?</p>
<p>We seek to write code that accomplishes something worthwhile, and to write in a simple, direct style that can be easily understood by anyone. This is easier said than done. There are some classic books with practical guidance that transcends specific programming languages, and we highly recommend the books of <span class="citation" data-cites="kernighan-plauger-1978">Kernighan and Plauger (<a href="../references.html#ref-kernighan-plauger-1978" role="doc-biblioref">1978</a>)</span>, <span class="citation" data-cites="knuth84">Knuth (<a href="../references.html#ref-knuth84" role="doc-biblioref">1984</a>)</span>, <span class="citation" data-cites="kernighan-pike-1999">Kernighan and Pike (<a href="../references.html#ref-kernighan-pike-1999" role="doc-biblioref">1999</a>)</span>, and <span class="citation" data-cites="hunt-thomas-1999">Hunt and Thomas (<a href="../references.html#ref-hunt-thomas-1999" role="doc-biblioref">1999</a>)</span>. The <a href="https://docs.julialang.org/en/v1/manual/style-guide/">style guide for the Julia programming language</a> also provides useful guidance. But since we are here, we will provide our own two cents on what we think are some of the key issues to writing “good” Julia code.</p>
<section id="formatting-conventions" class="level3" data-number="2.12.1">
<h3 data-number="2.12.1" class="anchored" data-anchor-id="formatting-conventions"><span class="header-section-number">2.12.1</span> Formatting conventions</h3>
<p>Julia code tends to have some common formatting conventions that make it easier to read code written by varying authors:</p>
<ul>
<li>Indentation by four spaces</li>
<li>Functions that modify (mutate) an input end with an exclamation mark</li>
<li>Module and type names use <code>CamelCase</code></li>
<li>Function names are <code>lowercase</code> and omit separators when feasible (underscores can be used otherwise)</li>
</ul>
<p>We also recommend limiting globally visible names (modules, structures, or functions) to Latin characters, or providing a Latin alternative when a larger set of Unicode characters is used (for example, <code>pi</code> as an alternative to <code>π</code>).</p>
<p>There are a number of style guides with more detailed opinions on the proper formatting of Julia code. If you want to adhere tightly to such a guide, we recommend a tool like <code>JuliaFormatter</code>.</p>
</section>
<section id="correctness-first" class="level3" data-number="2.12.2">
<h3 data-number="2.12.2" class="anchored" data-anchor-id="correctness-first"><span class="header-section-number">2.12.2</span> Correctness first</h3>
<p>Correctness is a tricky concept in numerical computing. Approximation is at the heart of most numerical methods, whether for data science or otherwise. Hence, we rarely get to decide whether we have “the right answer”; instead, we have to reason about whether the result of a computation is accurate enough for a downstream task. To make matters even more complicated, we usually face tradeoffs between speed and accuracy, and so need to design simultaneously for “right enough” and “fast enough.”</p>
<p>Neither correctness nor performance are easy to reason about. However, it is easier to tell when numerical code is slow than when it is wrong. Our mental models of <em>why</em> code is slow may often be wrong, but our observation <em>that</em> code is slow are not. Therefore, we usually want to start with simple code together with <em>analysis and tests</em> to ensure that it is accurate, and revise the code to tune performance later, informed by profiling (<a href="02-Performance.html" class="quarto-xref"><span>Chapter 3</span></a>).</p>
</section>
<section id="catch-errors-early" class="level3" data-number="2.12.3">
<h3 data-number="2.12.3" class="anchored" data-anchor-id="catch-errors-early"><span class="header-section-number">2.12.3</span> Catch errors early</h3>
<p>The earlier we catch an error, the easier it is to correct. We would rather:</p>
<ul>
<li>Catch conceptual errors before we start writing code.</li>
<li>Catch implementation errors at compile time than at run time.</li>
<li>Analyze errors in an individual function than have to perform a root cause analysis.</li>
</ul>
<p>Tests, type annotations, and careful assertions all help us with finding errors early.</p>
</section>
<section id="put-it-in-a-small-function" class="level3" data-number="2.12.4">
<h3 data-number="2.12.4" class="anchored" data-anchor-id="put-it-in-a-small-function"><span class="header-section-number">2.12.4</span> Put it in a (small) function</h3>
<p>For a human audience, functions are a natural unit for code. A well-designed function gives name to a concept, and ideally the name, comments, and code are all in obvious agreement – it “does what it says on the cover.” Small functions are also relatively easy to test. And assigning appropriate type annotations to the arguments and return values of a function also helps us catch errors in how the function is used.</p>
<p>Apart from readibility, there are good performance reasons for putting code in functions. The Julia compiler works with functions. Code written at a command line or in a script style will not be processed in the same way, and will typically run more slowly. It is also easier to use Julia’s analysis tools to understand the performance implications of design choices made in short functions.</p>
</section>
<section id="keep-the-scope-small" class="level3" data-number="2.12.5">
<h3 data-number="2.12.5" class="anchored" data-anchor-id="keep-the-scope-small"><span class="header-section-number">2.12.5</span> Keep the scope small</h3>
<p>Functions and control flow constructs in Julia create new scopes, so Julia variable names often have short lives. This is convenient for human readers, with our limited memories, particularly when we want to save typing and use short names. Variable names with limited scope (and limited opportunity for reassignment) are also easy for the compiler to analyze, and result in more efficient code.</p>
</section>
<section id="respect-interfaces" class="level3" data-number="2.12.6">
<h3 data-number="2.12.6" class="anchored" data-anchor-id="respect-interfaces"><span class="header-section-number">2.12.6</span> Respect interfaces</h3>
<p>Unlike some languages (e.g.&nbsp;Python, Java, and C++), Julia does not have a strong data hiding mechanism, though it is possible to code in a way that hides data structures (e.g.&nbsp;by tucking them inside functions). Nonetheless, if the option exists, it is usually preferable to use getter and setter functions rather than directly accessing the contents of a Julia structure. This makes it easier to monitor access to the data structures for debugging, and it makes it easier to change data structures as the code evolves.</p>
</section>
<section id="dry-dont-repeat-yourself" class="level3" data-number="2.12.7">
<h3 data-number="2.12.7" class="anchored" data-anchor-id="dry-dont-repeat-yourself"><span class="header-section-number">2.12.7</span> DRY (Don’t Repeat Yourself)</h3>
<p>A general design principle for any data system is that code and data should ideally have a single, concise, authoritative representation.</p>
<p>Compared to some languages, Julia code is fairly concise, and does not require much boilerplate<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. Several aspects of the language contribute to this conciseness:</p>
<ul>
<li>The ability of the system to dispatch to different methods based on argument types simplifies the process of writing generic code.</li>
<li>Functions are first-class entities that can be passed around with context, so we can pass around specialized functions for a specific subtask rather than coding it everywhere. For example, we can pass logging routines into our functions as callbacks rather than adding logging infrastructure to all our routines.</li>
<li>Conversion methods and promotion rules limit the number of variants of methods that we might have to write for different combinations of argument types.</li>
<li>When other methods fail, we can remove redundancy by writing macros to generate repetitive code for us.</li>
</ul>
</section>
<section id="kiss-and-yagni" class="level3" data-number="2.12.8">
<h3 data-number="2.12.8" class="anchored" data-anchor-id="kiss-and-yagni"><span class="header-section-number">2.12.8</span> KISS and YAGNI</h3>
<p>Peer to DRY in our opinions on design style are two other acronyms:</p>
<ul>
<li>KISS: Keep It Simple, Stupid</li>
<li>YAGNI: You Ain’t Gonna Need It</li>
</ul>
<p>That is, we want to start with simple, working code that solves a known problem, and only get fancier if there is a measurable reason to do so. Simple code and simple data structures are easier for people to read, and preferable absent other <em>real</em> concerns. For example, any number of Julia constructs that we have discussed (promotion rules, macros, and expansion of tuples into parameter lists) are arguably harder to read than alternative constructions. It is nice to have these features in the language in situations to avoid writing redundant code or to address performance bottlenecks during profiling. But if we have not observed redundancy or performance issues in practice, it is usually best to write the simplest thing possible. In the event we decide that we <em>do</em> need a less simple code construct, whether to avoid repetition or to deal with a performance issue, we have the experience of writing the short and simple thing first. And, as with writing English prose, it is usually easier to revise what exists than to start from a blank page.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-graham-1993" class="csl-entry" role="listitem">
Graham, Paul. 1993. <em>On <span>L</span>isp</em>. Prentice Hall. <a href="https://paulgraham.com/onlisp.html">https://paulgraham.com/onlisp.html</a>.
</div>
<div id="ref-hunt-thomas-1999" class="csl-entry" role="listitem">
Hunt, Andy, and David Thomas. 1999. <em>The Pragmatic Programmer: From Journeyman to Master</em>. Addison Wesley.
</div>
<div id="ref-kernighan-pike-1999" class="csl-entry" role="listitem">
Kernighan, Brian W., and Rob Pike. 1999. <em>The Practice of Programming</em>. Addison Wesley.
</div>
<div id="ref-kernighan-plauger-1978" class="csl-entry" role="listitem">
Kernighan, Brian W., and P. J. Plauger. 1978. <em>The Elements of Programming Style</em>. Second. McGraw-Hill.
</div>
<div id="ref-knuth84" class="csl-entry" role="listitem">
Knuth, Donald E. 1984. <span>“Literate Programming.”</span> <em>Comput. J.</em> 27 (2): 97–111. <a href="https://doi.org/10.1093/comjnl/27.2.97">https://doi.org/10.1093/comjnl/27.2.97</a>.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>In the beginning, the creators of the C language allowed the same piece of memory to be treated as belonging to different types. This has made a lot of people very angry and been widely regarded as a bad move.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>At the time of this writing, the default <code>Int</code> type in Julia is almost always 64 bits. It is not so easy to find 32-bit systems any more.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>In 2003, Joel Spolsky wrote a blog post on <a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">“The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)”</a>, which includes the memorably line “if you are a programmer working in 2003 and you don’t know the basics of characters, character sets, encodings, and Unicode, and I <em>catch</em> you, I’m going to punish you by making you peel onions for 6 months in a submarine. I swear I will.” That was two decades ago at the time of this writing. Unicode as a concept and UTF-8 as an encoding are both ubiquitous. There is no excuse for not knowing a little about it.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The notion of “null” is surprisingly subtle. This can refer to something that is “deliberately left blank” (e.g.&nbsp;a default value for an optional argument), something that is “well-defined but unknown” (e.g.&nbsp;a record of someone’s age) or something that is inappropriate to the task at hand (e.g.&nbsp;spouses’ name when not married).<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>As the Julia documentation points out, improvements to the compiler may mean this will no longer be an issue soon. This does not change the value of this as an example.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Per <a href="https://en.wikipedia.org/wiki/Boilerplate_text">Wikipedia</a>, the metal printing plates used for typesetting widely-distributed ads or syndicated columns were called “boilerplate” by analogy with the rolled steel plates used to make water biolers.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../00-Background/00-Intro.html" class="pagination-link" aria-label="Background Plus a Bit">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Background Plus a Bit</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../00-Background/02-Performance.html" class="pagination-link" aria-label="Performance Basics">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Performance Basics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>